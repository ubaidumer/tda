"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.parseEpochTimestamp = exports.parseRfc7231DateTime = exports.parseRfc3339DateTime = exports.dateToUtcString = void 0;
const parse_utils_1 = require("./parse-utils");
const DAYS = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
const MONTHS = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
function dateToUtcString(date) {
    const year = date.getUTCFullYear();
    const month = date.getUTCMonth();
    const dayOfWeek = date.getUTCDay();
    const dayOfMonthInt = date.getUTCDate();
    const hoursInt = date.getUTCHours();
    const minutesInt = date.getUTCMinutes();
    const secondsInt = date.getUTCSeconds();
    const dayOfMonthString = dayOfMonthInt < 10 ? `0${dayOfMonthInt}` : `${dayOfMonthInt}`;
    const hoursString = hoursInt < 10 ? `0${hoursInt}` : `${hoursInt}`;
    const minutesString = minutesInt < 10 ? `0${minutesInt}` : `${minutesInt}`;
    const secondsString = secondsInt < 10 ? `0${secondsInt}` : `${secondsInt}`;
    return `${DAYS[dayOfWeek]}, ${dayOfMonthString} ${MONTHS[month]} ${year} ${hoursString}:${minutesString}:${secondsString} GMT`;
}
exports.dateToUtcString = dateToUtcString;
const RFC3339 = new RegExp(/^(?<Y>\d{4})-(?<M>\d{2})-(?<D>\d{2})[tT](?<H>\d{2}):(?<m>\d{2}):(?<s>\d{2})(?:\.(?<frac>\d+))?[zZ]$/);
const parseRfc3339DateTime = (value) => {
    if (value === null || value === undefined) {
        return undefined;
    }
    if (typeof value !== "string") {
        throw new TypeError("RFC-3339 date-times must be expressed as strings");
    }
    const match = RFC3339.exec(value);
    if (!match || !match.groups) {
        throw new TypeError("Invalid RFC-3339 date-time value");
    }
    const year = parse_utils_1.strictParseShort(stripLeadingZeroes(match.groups["Y"]));
    const month = parseDateValue(match.groups["M"], "month", 1, 12);
    const day = parseDateValue(match.groups["D"], "day", 1, 31);
    return buildDate(year, month, day, match);
};
exports.parseRfc3339DateTime = parseRfc3339DateTime;
const IMF_FIXDATE = new RegExp(/^(?:Mon|Tue|Wed|Thu|Fri|Sat|Sun), (?<D>\d{2}) (?<M>Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (?<Y>\d{4}) (?<H>\d{2}):(?<m>\d{2}):(?<s>\d{2})(?:\.(?<frac>\d+))? GMT$/);
const RFC_850_DATE = new RegExp(/^(?:Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (?<D>\d{2})-(?<M>Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(?<Y>\d{2}) (?<H>\d{2}):(?<m>\d{2}):(?<s>\d{2})(?:\.(?<frac>\d+))? GMT$/);
const ASC_TIME = new RegExp(/^(?:Mon|Tue|Wed|Thu|Fri|Sat|Sun) (?<M>Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (?<D> [1-9]|\d{2}) (?<H>\d{2}):(?<m>\d{2}):(?<s>\d{2})(?:\.(?<frac>\d+))? (?<Y>\d{4})$/);
const parseRfc7231DateTime = (value) => {
    if (value === null || value === undefined) {
        return undefined;
    }
    if (typeof value !== "string") {
        throw new TypeError("RFC-7231 date-times must be expressed as strings");
    }
    let dayFn = (value) => parseDateValue(value, "day", 1, 31);
    let yearFn = (value) => parse_utils_1.strictParseShort(stripLeadingZeroes(value));
    let dateAdjustmentFn = (value) => value;
    let match = IMF_FIXDATE.exec(value);
    if (!match || !match.groups) {
        match = RFC_850_DATE.exec(value);
        if (match && match.groups) {
            yearFn = parseTwoDigitYear;
            dateAdjustmentFn = adjustRfc850Year;
        }
        else {
            match = ASC_TIME.exec(value);
            if (match && match.groups) {
                dayFn = (value) => parseDateValue(value.trimLeft(), "day", 1, 31);
            }
            else {
                throw new TypeError("Invalid RFC-7231 date-time value");
            }
        }
    }
    const year = yearFn(match.groups["Y"]);
    const month = parseMonthByShortName(match.groups["M"]);
    const day = dayFn(match.groups["D"]);
    return dateAdjustmentFn(buildDate(year, month, day, match));
};
exports.parseRfc7231DateTime = parseRfc7231DateTime;
const parseEpochTimestamp = (value) => {
    if (value === null || value === undefined) {
        return undefined;
    }
    let valueAsDouble;
    if (typeof value === "number") {
        valueAsDouble = value;
    }
    else if (typeof value === "string") {
        valueAsDouble = parse_utils_1.strictParseDouble(value);
    }
    else {
        throw new TypeError("Epoch timestamps must be expressed as floating point numbers or their string representation");
    }
    if (Number.isNaN(valueAsDouble) || valueAsDouble === Infinity || valueAsDouble === -Infinity) {
        throw new TypeError("Epoch timestamps must be valid, non-Infinite, non-NaN numerics");
    }
    return new Date(Math.round(valueAsDouble * 1000));
};
exports.parseEpochTimestamp = parseEpochTimestamp;
const buildDate = (year, month, day, match) => {
    const adjustedMonth = month - 1;
    validateDayOfMonth(year, adjustedMonth, day);
    return new Date(Date.UTC(year, adjustedMonth, day, parseDateValue(match.groups["H"], "hour", 0, 23), parseDateValue(match.groups["m"], "minute", 0, 59), parseDateValue(match.groups["s"], "seconds", 0, 60), parseMilliseconds(match.groups["frac"])));
};
const parseTwoDigitYear = (value) => {
    const thisYear = new Date().getUTCFullYear();
    const valueInThisCentury = Math.floor(thisYear / 100) * 100 + parse_utils_1.strictParseShort(stripLeadingZeroes(value));
    if (valueInThisCentury < thisYear) {
        return valueInThisCentury + 100;
    }
    return valueInThisCentury;
};
const FIFTY_YEARS_IN_MILLIS = 50 * 365 * 24 * 60 * 60 * 1000;
const adjustRfc850Year = (input) => {
    if (input.getTime() - new Date().getTime() > FIFTY_YEARS_IN_MILLIS) {
        return new Date(Date.UTC(input.getUTCFullYear() - 100, input.getUTCMonth(), input.getUTCDate(), input.getUTCHours(), input.getUTCMinutes(), input.getUTCSeconds(), input.getUTCMilliseconds()));
    }
    return input;
};
const parseMonthByShortName = (value) => {
    const monthIdx = MONTHS.indexOf(value);
    if (monthIdx < 0) {
        throw new TypeError(`Invalid month: ${value}`);
    }
    return monthIdx + 1;
};
const DAYS_IN_MONTH = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
const validateDayOfMonth = (year, month, day) => {
    let maxDays = DAYS_IN_MONTH[month];
    if (month === 1 && isLeapYear(year)) {
        maxDays = 29;
    }
    if (day > maxDays) {
        throw new TypeError(`Invalid day for ${MONTHS[month]} in ${year}: ${day}`);
    }
};
const isLeapYear = (year) => {
    return year % 4 === 0 && (year % 100 !== 0 || year % 400 === 0);
};
const parseDateValue = (value, type, lower, upper) => {
    const dateVal = parse_utils_1.strictParseByte(stripLeadingZeroes(value));
    if (dateVal < lower || dateVal > upper) {
        throw new TypeError(`${type} must be between ${lower} and ${upper}, inclusive`);
    }
    return dateVal;
};
const parseMilliseconds = (value) => {
    if (value === null || value === undefined) {
        return 0;
    }
    return parse_utils_1.strictParseFloat32("0." + value) * 1000;
};
const stripLeadingZeroes = (value) => {
    let idx = 0;
    while (idx < value.length - 1 && value.charAt(idx) === "0") {
        idx++;
    }
    if (idx === 0) {
        return value;
    }
    return value.slice(idx);
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0ZS11dGlscy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9kYXRlLXV0aWxzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLCtDQUF5RztBQUd6RyxNQUFNLElBQUksR0FBa0IsQ0FBQyxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLENBQUMsQ0FBQztBQUk5RSxNQUFNLE1BQU0sR0FBa0IsQ0FBQyxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFDO0FBYW5ILFNBQWdCLGVBQWUsQ0FBQyxJQUFVO0lBQ3hDLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQztJQUNuQyxNQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7SUFDakMsTUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO0lBQ25DLE1BQU0sYUFBYSxHQUFHLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztJQUN4QyxNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7SUFDcEMsTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO0lBQ3hDLE1BQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUl4QyxNQUFNLGdCQUFnQixHQUFHLGFBQWEsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksYUFBYSxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsYUFBYSxFQUFFLENBQUM7SUFDdkYsTUFBTSxXQUFXLEdBQUcsUUFBUSxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxRQUFRLEVBQUUsQ0FBQyxDQUFDLENBQUMsR0FBRyxRQUFRLEVBQUUsQ0FBQztJQUNuRSxNQUFNLGFBQWEsR0FBRyxVQUFVLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLFVBQVUsRUFBRSxDQUFDLENBQUMsQ0FBQyxHQUFHLFVBQVUsRUFBRSxDQUFDO0lBQzNFLE1BQU0sYUFBYSxHQUFHLFVBQVUsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksVUFBVSxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsVUFBVSxFQUFFLENBQUM7SUFFM0UsT0FBTyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxnQkFBZ0IsSUFBSSxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksSUFBSSxJQUFJLFdBQVcsSUFBSSxhQUFhLElBQUksYUFBYSxNQUFNLENBQUM7QUFDakksQ0FBQztBQWpCRCwwQ0FpQkM7QUFFRCxNQUFNLE9BQU8sR0FBRyxJQUFJLE1BQU0sQ0FDeEIscUdBQXFHLENBQ3RHLENBQUM7QUFlSyxNQUFNLG9CQUFvQixHQUFHLENBQUMsS0FBYyxFQUFvQixFQUFFO0lBQ3ZFLElBQUksS0FBSyxLQUFLLElBQUksSUFBSSxLQUFLLEtBQUssU0FBUyxFQUFFO1FBQ3pDLE9BQU8sU0FBUyxDQUFDO0tBQ2xCO0lBQ0QsSUFBSSxPQUFPLEtBQUssS0FBSyxRQUFRLEVBQUU7UUFDN0IsTUFBTSxJQUFJLFNBQVMsQ0FBQyxrREFBa0QsQ0FBQyxDQUFDO0tBQ3pFO0lBQ0QsTUFBTSxLQUFLLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUNsQyxJQUFJLENBQUMsS0FBSyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRTtRQUMzQixNQUFNLElBQUksU0FBUyxDQUFDLGtDQUFrQyxDQUFDLENBQUM7S0FDekQ7SUFDRCxNQUFNLElBQUksR0FBRyw4QkFBZ0IsQ0FBQyxrQkFBa0IsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUUsQ0FBQztJQUN0RSxNQUFNLEtBQUssR0FBRyxjQUFjLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsRUFBRSxPQUFPLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQ2hFLE1BQU0sR0FBRyxHQUFHLGNBQWMsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEtBQUssRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFFNUQsT0FBTyxTQUFTLENBQUMsSUFBSSxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsS0FBSyxDQUFDLENBQUM7QUFDNUMsQ0FBQyxDQUFDO0FBaEJXLFFBQUEsb0JBQW9CLHdCQWdCL0I7QUFFRixNQUFNLFdBQVcsR0FBRyxJQUFJLE1BQU0sQ0FDNUIsNktBQTZLLENBQzlLLENBQUM7QUFDRixNQUFNLFlBQVksR0FBRyxJQUFJLE1BQU0sQ0FDN0IsME1BQTBNLENBQzNNLENBQUM7QUFDRixNQUFNLFFBQVEsR0FBRyxJQUFJLE1BQU0sQ0FDekIsK0tBQStLLENBQ2hMLENBQUM7QUFjSyxNQUFNLG9CQUFvQixHQUFHLENBQUMsS0FBYyxFQUFvQixFQUFFO0lBQ3ZFLElBQUksS0FBSyxLQUFLLElBQUksSUFBSSxLQUFLLEtBQUssU0FBUyxFQUFFO1FBQ3pDLE9BQU8sU0FBUyxDQUFDO0tBQ2xCO0lBQ0QsSUFBSSxPQUFPLEtBQUssS0FBSyxRQUFRLEVBQUU7UUFDN0IsTUFBTSxJQUFJLFNBQVMsQ0FBQyxrREFBa0QsQ0FBQyxDQUFDO0tBQ3pFO0lBR0QsSUFBSSxLQUFLLEdBQThCLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxjQUFjLENBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFHdEYsSUFBSSxNQUFNLEdBQThCLENBQUMsS0FBYSxFQUFFLEVBQUUsQ0FBQyw4QkFBZ0IsQ0FBQyxrQkFBa0IsQ0FBQyxLQUFLLENBQUMsQ0FBRSxDQUFDO0lBRXhHLElBQUksZ0JBQWdCLEdBQTBCLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxLQUFLLENBQUM7SUFFL0QsSUFBSSxLQUFLLEdBQUcsV0FBVyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUNwQyxJQUFJLENBQUMsS0FBSyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRTtRQUMzQixLQUFLLEdBQUcsWUFBWSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNqQyxJQUFJLEtBQUssSUFBSSxLQUFLLENBQUMsTUFBTSxFQUFFO1lBSXpCLE1BQU0sR0FBRyxpQkFBaUIsQ0FBQztZQUMzQixnQkFBZ0IsR0FBRyxnQkFBZ0IsQ0FBQztTQUNyQzthQUFNO1lBQ0wsS0FBSyxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDN0IsSUFBSSxLQUFLLElBQUksS0FBSyxDQUFDLE1BQU0sRUFBRTtnQkFDekIsS0FBSyxHQUFHLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxjQUFjLENBQUMsS0FBSyxDQUFDLFFBQVEsRUFBRSxFQUFFLEtBQUssRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7YUFDbkU7aUJBQU07Z0JBQ0wsTUFBTSxJQUFJLFNBQVMsQ0FBQyxrQ0FBa0MsQ0FBQyxDQUFDO2FBQ3pEO1NBQ0Y7S0FDRjtJQUVELE1BQU0sSUFBSSxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFDdkMsTUFBTSxLQUFLLEdBQUcscUJBQXFCLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO0lBQ3ZELE1BQU0sR0FBRyxHQUFHLEtBQUssQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFDckMsT0FBTyxnQkFBZ0IsQ0FBQyxTQUFTLENBQUMsSUFBSSxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQztBQUM5RCxDQUFDLENBQUM7QUF2Q1csUUFBQSxvQkFBb0Isd0JBdUMvQjtBQVdLLE1BQU0sbUJBQW1CLEdBQUcsQ0FBQyxLQUFjLEVBQW9CLEVBQUU7SUFDdEUsSUFBSSxLQUFLLEtBQUssSUFBSSxJQUFJLEtBQUssS0FBSyxTQUFTLEVBQUU7UUFDekMsT0FBTyxTQUFTLENBQUM7S0FDbEI7SUFFRCxJQUFJLGFBQXFCLENBQUM7SUFDMUIsSUFBSSxPQUFPLEtBQUssS0FBSyxRQUFRLEVBQUU7UUFDN0IsYUFBYSxHQUFHLEtBQUssQ0FBQztLQUN2QjtTQUFNLElBQUksT0FBTyxLQUFLLEtBQUssUUFBUSxFQUFFO1FBQ3BDLGFBQWEsR0FBRywrQkFBaUIsQ0FBQyxLQUFLLENBQUUsQ0FBQztLQUMzQztTQUFNO1FBQ0wsTUFBTSxJQUFJLFNBQVMsQ0FBQyw2RkFBNkYsQ0FBQyxDQUFDO0tBQ3BIO0lBRUQsSUFBSSxNQUFNLENBQUMsS0FBSyxDQUFDLGFBQWEsQ0FBQyxJQUFJLGFBQWEsS0FBSyxRQUFRLElBQUksYUFBYSxLQUFLLENBQUMsUUFBUSxFQUFFO1FBQzVGLE1BQU0sSUFBSSxTQUFTLENBQUMsZ0VBQWdFLENBQUMsQ0FBQztLQUN2RjtJQUNELE9BQU8sSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxhQUFhLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQztBQUNwRCxDQUFDLENBQUM7QUFsQlcsUUFBQSxtQkFBbUIsdUJBa0I5QjtBQVVGLE1BQU0sU0FBUyxHQUFHLENBQUMsSUFBWSxFQUFFLEtBQWEsRUFBRSxHQUFXLEVBQUUsS0FBdUIsRUFBUSxFQUFFO0lBQzVGLE1BQU0sYUFBYSxHQUFHLEtBQUssR0FBRyxDQUFDLENBQUM7SUFDaEMsa0JBQWtCLENBQUMsSUFBSSxFQUFFLGFBQWEsRUFBRSxHQUFHLENBQUMsQ0FBQztJQUU3QyxPQUFPLElBQUksSUFBSSxDQUNiLElBQUksQ0FBQyxHQUFHLENBQ04sSUFBSSxFQUNKLGFBQWEsRUFDYixHQUFHLEVBQ0gsY0FBYyxDQUFDLEtBQUssQ0FBQyxNQUFPLENBQUMsR0FBRyxDQUFFLEVBQUUsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsRUFDbEQsY0FBYyxDQUFDLEtBQUssQ0FBQyxNQUFPLENBQUMsR0FBRyxDQUFFLEVBQUUsUUFBUSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsRUFFcEQsY0FBYyxDQUFDLEtBQUssQ0FBQyxNQUFPLENBQUMsR0FBRyxDQUFFLEVBQUUsU0FBUyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsRUFDckQsaUJBQWlCLENBQUMsS0FBSyxDQUFDLE1BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUN6QyxDQUNGLENBQUM7QUFDSixDQUFDLENBQUM7QUFlRixNQUFNLGlCQUFpQixHQUFHLENBQUMsS0FBYSxFQUFVLEVBQUU7SUFDbEQsTUFBTSxRQUFRLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQyxjQUFjLEVBQUUsQ0FBQztJQUM3QyxNQUFNLGtCQUFrQixHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxHQUFHLEdBQUcsQ0FBQyxHQUFHLEdBQUcsR0FBRyw4QkFBZ0IsQ0FBQyxrQkFBa0IsQ0FBQyxLQUFLLENBQUMsQ0FBRSxDQUFDO0lBQzNHLElBQUksa0JBQWtCLEdBQUcsUUFBUSxFQUFFO1FBSWpDLE9BQU8sa0JBQWtCLEdBQUcsR0FBRyxDQUFDO0tBQ2pDO0lBQ0QsT0FBTyxrQkFBa0IsQ0FBQztBQUM1QixDQUFDLENBQUM7QUFFRixNQUFNLHFCQUFxQixHQUFHLEVBQUUsR0FBRyxHQUFHLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsSUFBSSxDQUFDO0FBYzdELE1BQU0sZ0JBQWdCLEdBQUcsQ0FBQyxLQUFXLEVBQVEsRUFBRTtJQUM3QyxJQUFJLEtBQUssQ0FBQyxPQUFPLEVBQUUsR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDLE9BQU8sRUFBRSxHQUFHLHFCQUFxQixFQUFFO1FBQ2xFLE9BQU8sSUFBSSxJQUFJLENBQ2IsSUFBSSxDQUFDLEdBQUcsQ0FDTixLQUFLLENBQUMsY0FBYyxFQUFFLEdBQUcsR0FBRyxFQUM1QixLQUFLLENBQUMsV0FBVyxFQUFFLEVBQ25CLEtBQUssQ0FBQyxVQUFVLEVBQUUsRUFDbEIsS0FBSyxDQUFDLFdBQVcsRUFBRSxFQUNuQixLQUFLLENBQUMsYUFBYSxFQUFFLEVBQ3JCLEtBQUssQ0FBQyxhQUFhLEVBQUUsRUFDckIsS0FBSyxDQUFDLGtCQUFrQixFQUFFLENBQzNCLENBQ0YsQ0FBQztLQUNIO0lBQ0QsT0FBTyxLQUFLLENBQUM7QUFDZixDQUFDLENBQUM7QUFFRixNQUFNLHFCQUFxQixHQUFHLENBQUMsS0FBYSxFQUFVLEVBQUU7SUFDdEQsTUFBTSxRQUFRLEdBQUcsTUFBTSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUN2QyxJQUFJLFFBQVEsR0FBRyxDQUFDLEVBQUU7UUFDaEIsTUFBTSxJQUFJLFNBQVMsQ0FBQyxrQkFBa0IsS0FBSyxFQUFFLENBQUMsQ0FBQztLQUNoRDtJQUNELE9BQU8sUUFBUSxHQUFHLENBQUMsQ0FBQztBQUN0QixDQUFDLENBQUM7QUFFRixNQUFNLGFBQWEsR0FBRyxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUM7QUFRdkUsTUFBTSxrQkFBa0IsR0FBRyxDQUFDLElBQVksRUFBRSxLQUFhLEVBQUUsR0FBVyxFQUFFLEVBQUU7SUFDdEUsSUFBSSxPQUFPLEdBQUcsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ25DLElBQUksS0FBSyxLQUFLLENBQUMsSUFBSSxVQUFVLENBQUMsSUFBSSxDQUFDLEVBQUU7UUFDbkMsT0FBTyxHQUFHLEVBQUUsQ0FBQztLQUNkO0lBRUQsSUFBSSxHQUFHLEdBQUcsT0FBTyxFQUFFO1FBQ2pCLE1BQU0sSUFBSSxTQUFTLENBQUMsbUJBQW1CLE1BQU0sQ0FBQyxLQUFLLENBQUMsT0FBTyxJQUFJLEtBQUssR0FBRyxFQUFFLENBQUMsQ0FBQztLQUM1RTtBQUNILENBQUMsQ0FBQztBQUVGLE1BQU0sVUFBVSxHQUFHLENBQUMsSUFBWSxFQUFXLEVBQUU7SUFDM0MsT0FBTyxJQUFJLEdBQUcsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksR0FBRyxHQUFHLEtBQUssQ0FBQyxJQUFJLElBQUksR0FBRyxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUM7QUFDbEUsQ0FBQyxDQUFDO0FBRUYsTUFBTSxjQUFjLEdBQUcsQ0FBQyxLQUFhLEVBQUUsSUFBWSxFQUFFLEtBQWEsRUFBRSxLQUFhLEVBQVUsRUFBRTtJQUMzRixNQUFNLE9BQU8sR0FBRyw2QkFBZSxDQUFDLGtCQUFrQixDQUFDLEtBQUssQ0FBQyxDQUFFLENBQUM7SUFDNUQsSUFBSSxPQUFPLEdBQUcsS0FBSyxJQUFJLE9BQU8sR0FBRyxLQUFLLEVBQUU7UUFDdEMsTUFBTSxJQUFJLFNBQVMsQ0FBQyxHQUFHLElBQUksb0JBQW9CLEtBQUssUUFBUSxLQUFLLGFBQWEsQ0FBQyxDQUFDO0tBQ2pGO0lBQ0QsT0FBTyxPQUFPLENBQUM7QUFDakIsQ0FBQyxDQUFDO0FBRUYsTUFBTSxpQkFBaUIsR0FBRyxDQUFDLEtBQXlCLEVBQVUsRUFBRTtJQUM5RCxJQUFJLEtBQUssS0FBSyxJQUFJLElBQUksS0FBSyxLQUFLLFNBQVMsRUFBRTtRQUN6QyxPQUFPLENBQUMsQ0FBQztLQUNWO0lBRUQsT0FBTyxnQ0FBa0IsQ0FBQyxJQUFJLEdBQUcsS0FBSyxDQUFFLEdBQUcsSUFBSSxDQUFDO0FBQ2xELENBQUMsQ0FBQztBQUVGLE1BQU0sa0JBQWtCLEdBQUcsQ0FBQyxLQUFhLEVBQVUsRUFBRTtJQUNuRCxJQUFJLEdBQUcsR0FBRyxDQUFDLENBQUM7SUFDWixPQUFPLEdBQUcsR0FBRyxLQUFLLENBQUMsTUFBTSxHQUFHLENBQUMsSUFBSSxLQUFLLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxLQUFLLEdBQUcsRUFBRTtRQUMxRCxHQUFHLEVBQUUsQ0FBQztLQUNQO0lBQ0QsSUFBSSxHQUFHLEtBQUssQ0FBQyxFQUFFO1FBQ2IsT0FBTyxLQUFLLENBQUM7S0FDZDtJQUNELE9BQU8sS0FBSyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztBQUMxQixDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBzdHJpY3RQYXJzZUJ5dGUsIHN0cmljdFBhcnNlRG91YmxlLCBzdHJpY3RQYXJzZUZsb2F0MzIsIHN0cmljdFBhcnNlU2hvcnQgfSBmcm9tIFwiLi9wYXJzZS11dGlsc1wiO1xuXG4vLyBCdWlsZCBpbmRleGVzIG91dHNpZGUgc28gd2UgYWxsb2NhdGUgdGhlbSBvbmNlLlxuY29uc3QgREFZUzogQXJyYXk8U3RyaW5nPiA9IFtcIlN1blwiLCBcIk1vblwiLCBcIlR1ZVwiLCBcIldlZFwiLCBcIlRodVwiLCBcIkZyaVwiLCBcIlNhdFwiXTtcblxuLy8gVGhlc2UgbXVzdCBiZSBrZXB0IGluIG9yZGVyXG4vLyBwcmV0dGllci1pZ25vcmVcbmNvbnN0IE1PTlRIUzogQXJyYXk8U3RyaW5nPiA9IFtcIkphblwiLCBcIkZlYlwiLCBcIk1hclwiLCBcIkFwclwiLCBcIk1heVwiLCBcIkp1blwiLCBcIkp1bFwiLCBcIkF1Z1wiLCBcIlNlcFwiLCBcIk9jdFwiLCBcIk5vdlwiLCBcIkRlY1wiXTtcblxuLyoqXG4gKiBCdWlsZHMgYSBwcm9wZXIgVVRDIEh0dHBEYXRlIHRpbWVzdGFtcCBmcm9tIGEgRGF0ZSBvYmplY3RcbiAqIHNpbmNlIG5vdCBhbGwgZW52aXJvbm1lbnRzIHdpbGwgaGF2ZSB0aGlzIGFzIHRoZSBleHBlY3RlZFxuICogZm9ybWF0LlxuICpcbiAqIFNlZTogaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvRGF0ZS90b1VUQ1N0cmluZ1xuICogPiBQcmlvciB0byBFQ01BU2NyaXB0IDIwMTgsIHRoZSBmb3JtYXQgb2YgdGhlIHJldHVybiB2YWx1ZVxuICogPiB2YXJpZWQgYWNjb3JkaW5nIHRvIHRoZSBwbGF0Zm9ybS4gVGhlIG1vc3QgY29tbW9uIHJldHVyblxuICogPiB2YWx1ZSB3YXMgYW4gUkZDLTExMjMgZm9ybWF0dGVkIGRhdGUgc3RhbXAsIHdoaWNoIGlzIGFcbiAqID4gc2xpZ2h0bHkgdXBkYXRlZCB2ZXJzaW9uIG9mIFJGQy04MjIgZGF0ZSBzdGFtcHMuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBkYXRlVG9VdGNTdHJpbmcoZGF0ZTogRGF0ZSk6IHN0cmluZyB7XG4gIGNvbnN0IHllYXIgPSBkYXRlLmdldFVUQ0Z1bGxZZWFyKCk7XG4gIGNvbnN0IG1vbnRoID0gZGF0ZS5nZXRVVENNb250aCgpO1xuICBjb25zdCBkYXlPZldlZWsgPSBkYXRlLmdldFVUQ0RheSgpO1xuICBjb25zdCBkYXlPZk1vbnRoSW50ID0gZGF0ZS5nZXRVVENEYXRlKCk7XG4gIGNvbnN0IGhvdXJzSW50ID0gZGF0ZS5nZXRVVENIb3VycygpO1xuICBjb25zdCBtaW51dGVzSW50ID0gZGF0ZS5nZXRVVENNaW51dGVzKCk7XG4gIGNvbnN0IHNlY29uZHNJbnQgPSBkYXRlLmdldFVUQ1NlY29uZHMoKTtcblxuICAvLyBCdWlsZCAwIHByZWZpeGVkIHN0cmluZ3MgZm9yIGNvbnRlbnRzIHRoYXQgbmVlZCB0byBiZVxuICAvLyB0d28gZGlnaXRzIGFuZCB3aGVyZSB3ZSBnZXQgYW4gaW50ZWdlciBiYWNrLlxuICBjb25zdCBkYXlPZk1vbnRoU3RyaW5nID0gZGF5T2ZNb250aEludCA8IDEwID8gYDAke2RheU9mTW9udGhJbnR9YCA6IGAke2RheU9mTW9udGhJbnR9YDtcbiAgY29uc3QgaG91cnNTdHJpbmcgPSBob3Vyc0ludCA8IDEwID8gYDAke2hvdXJzSW50fWAgOiBgJHtob3Vyc0ludH1gO1xuICBjb25zdCBtaW51dGVzU3RyaW5nID0gbWludXRlc0ludCA8IDEwID8gYDAke21pbnV0ZXNJbnR9YCA6IGAke21pbnV0ZXNJbnR9YDtcbiAgY29uc3Qgc2Vjb25kc1N0cmluZyA9IHNlY29uZHNJbnQgPCAxMCA/IGAwJHtzZWNvbmRzSW50fWAgOiBgJHtzZWNvbmRzSW50fWA7XG5cbiAgcmV0dXJuIGAke0RBWVNbZGF5T2ZXZWVrXX0sICR7ZGF5T2ZNb250aFN0cmluZ30gJHtNT05USFNbbW9udGhdfSAke3llYXJ9ICR7aG91cnNTdHJpbmd9OiR7bWludXRlc1N0cmluZ306JHtzZWNvbmRzU3RyaW5nfSBHTVRgO1xufVxuXG5jb25zdCBSRkMzMzM5ID0gbmV3IFJlZ0V4cChcbiAgL14oPzxZPlxcZHs0fSktKD88TT5cXGR7Mn0pLSg/PEQ+XFxkezJ9KVt0VF0oPzxIPlxcZHsyfSk6KD88bT5cXGR7Mn0pOig/PHM+XFxkezJ9KSg/OlxcLig/PGZyYWM+XFxkKykpP1t6Wl0kL1xuKTtcblxuLyoqXG4gKiBQYXJzZXMgYSB2YWx1ZSBpbnRvIGEgRGF0ZS4gUmV0dXJucyB1bmRlZmluZWQgaWYgdGhlIGlucHV0IGlzIG51bGwgb3JcbiAqIHVuZGVmaW5lZCwgdGhyb3dzIGFuIGVycm9yIGlmIHRoZSBpbnB1dCBpcyBub3QgYSBzdHJpbmcgdGhhdCBjYW4gYmUgcGFyc2VkXG4gKiBhcyBhbiBSRkMgMzMzOSBkYXRlLlxuICpcbiAqIElucHV0IHN0cmluZ3MgbXVzdCBjb25mb3JtIHRvIFJGQzMzMzkgc2VjdGlvbiA1LjYsIGFuZCBjYW5ub3QgaGF2ZSBhIFVUQ1xuICogb2Zmc2V0LiBGcmFjdGlvbmFsIHByZWNpc2lvbiBpcyBzdXBwb3J0ZWQuXG4gKlxuICoge0BzZWUgaHR0cHM6Ly94bWwycmZjLnRvb2xzLmlldGYub3JnL3B1YmxpYy9yZmMvaHRtbC9yZmMzMzM5Lmh0bWwjYW5jaG9yMTR9XG4gKlxuICogQHBhcmFtIHZhbHVlIHRoZSB2YWx1ZSB0byBwYXJzZVxuICogQHJldHVybiBhIERhdGUgb3IgdW5kZWZpbmVkXG4gKi9cbmV4cG9ydCBjb25zdCBwYXJzZVJmYzMzMzlEYXRlVGltZSA9ICh2YWx1ZTogdW5rbm93bik6IERhdGUgfCB1bmRlZmluZWQgPT4ge1xuICBpZiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cbiAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gXCJzdHJpbmdcIikge1xuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJSRkMtMzMzOSBkYXRlLXRpbWVzIG11c3QgYmUgZXhwcmVzc2VkIGFzIHN0cmluZ3NcIik7XG4gIH1cbiAgY29uc3QgbWF0Y2ggPSBSRkMzMzM5LmV4ZWModmFsdWUpO1xuICBpZiAoIW1hdGNoIHx8ICFtYXRjaC5ncm91cHMpIHtcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiSW52YWxpZCBSRkMtMzMzOSBkYXRlLXRpbWUgdmFsdWVcIik7XG4gIH1cbiAgY29uc3QgeWVhciA9IHN0cmljdFBhcnNlU2hvcnQoc3RyaXBMZWFkaW5nWmVyb2VzKG1hdGNoLmdyb3Vwc1tcIllcIl0pKSE7XG4gIGNvbnN0IG1vbnRoID0gcGFyc2VEYXRlVmFsdWUobWF0Y2guZ3JvdXBzW1wiTVwiXSwgXCJtb250aFwiLCAxLCAxMik7XG4gIGNvbnN0IGRheSA9IHBhcnNlRGF0ZVZhbHVlKG1hdGNoLmdyb3Vwc1tcIkRcIl0sIFwiZGF5XCIsIDEsIDMxKTtcblxuICByZXR1cm4gYnVpbGREYXRlKHllYXIsIG1vbnRoLCBkYXksIG1hdGNoKTtcbn07XG5cbmNvbnN0IElNRl9GSVhEQVRFID0gbmV3IFJlZ0V4cChcbiAgL14oPzpNb258VHVlfFdlZHxUaHV8RnJpfFNhdHxTdW4pLCAoPzxEPlxcZHsyfSkgKD88TT5KYW58RmVifE1hcnxBcHJ8TWF5fEp1bnxKdWx8QXVnfFNlcHxPY3R8Tm92fERlYykgKD88WT5cXGR7NH0pICg/PEg+XFxkezJ9KTooPzxtPlxcZHsyfSk6KD88cz5cXGR7Mn0pKD86XFwuKD88ZnJhYz5cXGQrKSk/IEdNVCQvXG4pO1xuY29uc3QgUkZDXzg1MF9EQVRFID0gbmV3IFJlZ0V4cChcbiAgL14oPzpNb25kYXl8VHVlc2RheXxXZWRuZXNkYXl8VGh1cnNkYXl8RnJpZGF5fFNhdHVyZGF5fFN1bmRheSksICg/PEQ+XFxkezJ9KS0oPzxNPkphbnxGZWJ8TWFyfEFwcnxNYXl8SnVufEp1bHxBdWd8U2VwfE9jdHxOb3Z8RGVjKS0oPzxZPlxcZHsyfSkgKD88SD5cXGR7Mn0pOig/PG0+XFxkezJ9KTooPzxzPlxcZHsyfSkoPzpcXC4oPzxmcmFjPlxcZCspKT8gR01UJC9cbik7XG5jb25zdCBBU0NfVElNRSA9IG5ldyBSZWdFeHAoXG4gIC9eKD86TW9ufFR1ZXxXZWR8VGh1fEZyaXxTYXR8U3VuKSAoPzxNPkphbnxGZWJ8TWFyfEFwcnxNYXl8SnVufEp1bHxBdWd8U2VwfE9jdHxOb3Z8RGVjKSAoPzxEPiBbMS05XXxcXGR7Mn0pICg/PEg+XFxkezJ9KTooPzxtPlxcZHsyfSk6KD88cz5cXGR7Mn0pKD86XFwuKD88ZnJhYz5cXGQrKSk/ICg/PFk+XFxkezR9KSQvXG4pO1xuXG4vKipcbiAqIFBhcnNlcyBhIHZhbHVlIGludG8gYSBEYXRlLiBSZXR1cm5zIHVuZGVmaW5lZCBpZiB0aGUgaW5wdXQgaXMgbnVsbCBvclxuICogdW5kZWZpbmVkLCB0aHJvd3MgYW4gZXJyb3IgaWYgdGhlIGlucHV0IGlzIG5vdCBhIHN0cmluZyB0aGF0IGNhbiBiZSBwYXJzZWRcbiAqIGFzIGFuIFJGQyA3MjMxIElNRi1maXhkYXRlIG9yIG9icy1kYXRlLlxuICpcbiAqIElucHV0IHN0cmluZ3MgbXVzdCBjb25mb3JtIHRvIFJGQzcyMzEgc2VjdGlvbiA3LjEuMS4xLiBGcmFjdGlvbmFsIHNlY29uZHMgYXJlIHN1cHBvcnRlZC5cbiAqXG4gKiB7QHNlZSBodHRwczovL2RhdGF0cmFja2VyLmlldGYub3JnL2RvYy9odG1sL3JmYzcyMzEuaHRtbCNzZWN0aW9uLTcuMS4xLjF9XG4gKlxuICogQHBhcmFtIHZhbHVlIHRoZSB2YWx1ZSB0byBwYXJzZVxuICogQHJldHVybiBhIERhdGUgb3IgdW5kZWZpbmVkXG4gKi9cbmV4cG9ydCBjb25zdCBwYXJzZVJmYzcyMzFEYXRlVGltZSA9ICh2YWx1ZTogdW5rbm93bik6IERhdGUgfCB1bmRlZmluZWQgPT4ge1xuICBpZiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cbiAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gXCJzdHJpbmdcIikge1xuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJSRkMtNzIzMSBkYXRlLXRpbWVzIG11c3QgYmUgZXhwcmVzc2VkIGFzIHN0cmluZ3NcIik7XG4gIH1cblxuICAvL2FsbG93IGN1c3RvbWl6YXRpb24gb2YgZGF5IHBhcnNpbmcgZm9yIGFzY3RpbWUgZGF5cywgd2hpY2ggY2FuIGJlIGxlZnQtcGFkZGVkIHdpdGggc3BhY2VzXG4gIGxldCBkYXlGbjogKHZhbHVlOiBzdHJpbmcpID0+IG51bWJlciA9ICh2YWx1ZSkgPT4gcGFyc2VEYXRlVmFsdWUodmFsdWUsIFwiZGF5XCIsIDEsIDMxKTtcblxuICAvL2FsbCBmb3JtYXRzIG90aGVyIHRoYW4gUkZDIDg1MCB1c2UgYSBmb3VyLWRpZ2l0IHllYXJcbiAgbGV0IHllYXJGbjogKHZhbHVlOiBzdHJpbmcpID0+IG51bWJlciA9ICh2YWx1ZTogc3RyaW5nKSA9PiBzdHJpY3RQYXJzZVNob3J0KHN0cmlwTGVhZGluZ1plcm9lcyh2YWx1ZSkpITtcbiAgLy9SRkMgODUwIGRhdGVzIG5lZWQgcG9zdC1wcm9jZXNzaW5nIHRvIGFkanVzdCB5ZWFyIHZhbHVlcyBpZiB0aGV5IGFyZSB0b28gZmFyIGluIHRoZSBmdXR1cmVcbiAgbGV0IGRhdGVBZGp1c3RtZW50Rm46ICh2YWx1ZTogRGF0ZSkgPT4gRGF0ZSA9ICh2YWx1ZSkgPT4gdmFsdWU7XG5cbiAgbGV0IG1hdGNoID0gSU1GX0ZJWERBVEUuZXhlYyh2YWx1ZSk7XG4gIGlmICghbWF0Y2ggfHwgIW1hdGNoLmdyb3Vwcykge1xuICAgIG1hdGNoID0gUkZDXzg1MF9EQVRFLmV4ZWModmFsdWUpO1xuICAgIGlmIChtYXRjaCAmJiBtYXRjaC5ncm91cHMpIHtcbiAgICAgIC8vIFJGQyA4NTAgZGF0ZXMgdXNlIDItZGlnaXQgeWVhcnMuIFNvIHdlIHBhcnNlIHRoZSB5ZWFyIHNwZWNpZmljYWxseSxcbiAgICAgIC8vIGFuZCB0aGVuIG9uY2Ugd2UndmUgY29uc3RydWN0ZWQgdGhlIGVudGlyZSBkYXRlLCB3ZSBhZGp1c3QgaXQgaWYgdGhlIHJlc3VsdGFudCBkYXRlXG4gICAgICAvLyBpcyB0b28gZmFyIGluIHRoZSBmdXR1cmUuXG4gICAgICB5ZWFyRm4gPSBwYXJzZVR3b0RpZ2l0WWVhcjtcbiAgICAgIGRhdGVBZGp1c3RtZW50Rm4gPSBhZGp1c3RSZmM4NTBZZWFyO1xuICAgIH0gZWxzZSB7XG4gICAgICBtYXRjaCA9IEFTQ19USU1FLmV4ZWModmFsdWUpO1xuICAgICAgaWYgKG1hdGNoICYmIG1hdGNoLmdyb3Vwcykge1xuICAgICAgICBkYXlGbiA9ICh2YWx1ZSkgPT4gcGFyc2VEYXRlVmFsdWUodmFsdWUudHJpbUxlZnQoKSwgXCJkYXlcIiwgMSwgMzEpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkludmFsaWQgUkZDLTcyMzEgZGF0ZS10aW1lIHZhbHVlXCIpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGNvbnN0IHllYXIgPSB5ZWFyRm4obWF0Y2guZ3JvdXBzW1wiWVwiXSk7XG4gIGNvbnN0IG1vbnRoID0gcGFyc2VNb250aEJ5U2hvcnROYW1lKG1hdGNoLmdyb3Vwc1tcIk1cIl0pO1xuICBjb25zdCBkYXkgPSBkYXlGbihtYXRjaC5ncm91cHNbXCJEXCJdKTtcbiAgcmV0dXJuIGRhdGVBZGp1c3RtZW50Rm4oYnVpbGREYXRlKHllYXIsIG1vbnRoLCBkYXksIG1hdGNoKSk7XG59O1xuXG4vKipcbiAqIFBhcnNlcyBhIHZhbHVlIGludG8gYSBEYXRlLiBSZXR1cm5zIHVuZGVmaW5lZCBpZiB0aGUgaW5wdXQgaXMgbnVsbCBvclxuICogdW5kZWZpbmVkLCB0aHJvd3MgYW4gZXJyb3IgaWYgdGhlIGlucHV0IGlzIG5vdCBhIG51bWJlciBvciBhIHBhcnNlYWJsZSBzdHJpbmcuXG4gKlxuICogSW5wdXQgc3RyaW5ncyBtdXN0IGJlIGFuIGludGVnZXIgb3IgZmxvYXRpbmcgcG9pbnQgbnVtYmVyLiBGcmFjdGlvbmFsIHNlY29uZHMgYXJlIHN1cHBvcnRlZC5cbiAqXG4gKiBAcGFyYW0gdmFsdWUgdGhlIHZhbHVlIHRvIHBhcnNlXG4gKiBAcmV0dXJuIGEgRGF0ZSBvciB1bmRlZmluZWRcbiAqL1xuZXhwb3J0IGNvbnN0IHBhcnNlRXBvY2hUaW1lc3RhbXAgPSAodmFsdWU6IHVua25vd24pOiBEYXRlIHwgdW5kZWZpbmVkID0+IHtcbiAgaWYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQpIHtcbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG5cbiAgbGV0IHZhbHVlQXNEb3VibGU6IG51bWJlcjtcbiAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gXCJudW1iZXJcIikge1xuICAgIHZhbHVlQXNEb3VibGUgPSB2YWx1ZTtcbiAgfSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09IFwic3RyaW5nXCIpIHtcbiAgICB2YWx1ZUFzRG91YmxlID0gc3RyaWN0UGFyc2VEb3VibGUodmFsdWUpITtcbiAgfSBlbHNlIHtcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiRXBvY2ggdGltZXN0YW1wcyBtdXN0IGJlIGV4cHJlc3NlZCBhcyBmbG9hdGluZyBwb2ludCBudW1iZXJzIG9yIHRoZWlyIHN0cmluZyByZXByZXNlbnRhdGlvblwiKTtcbiAgfVxuXG4gIGlmIChOdW1iZXIuaXNOYU4odmFsdWVBc0RvdWJsZSkgfHwgdmFsdWVBc0RvdWJsZSA9PT0gSW5maW5pdHkgfHwgdmFsdWVBc0RvdWJsZSA9PT0gLUluZmluaXR5KSB7XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkVwb2NoIHRpbWVzdGFtcHMgbXVzdCBiZSB2YWxpZCwgbm9uLUluZmluaXRlLCBub24tTmFOIG51bWVyaWNzXCIpO1xuICB9XG4gIHJldHVybiBuZXcgRGF0ZShNYXRoLnJvdW5kKHZhbHVlQXNEb3VibGUgKiAxMDAwKSk7XG59O1xuXG4vKipcbiAqIEJ1aWxkIGEgZGF0ZSBmcm9tIGEgbnVtZXJpYyB5ZWFyLCBtb250aCwgZGF0ZSwgYW5kIGFuIG1hdGNoIHdpdGggbmFtZWQgZ3JvdXBzXG4gKiBcIkhcIiwgXCJtXCIsIHNcIiwgYW5kIFwiZnJhY1wiLCByZXByZXNlbnRpbmcgaG91cnMsIG1pbnV0ZXMsIHNlY29uZHMsIGFuZCBvcHRpb25hbCBmcmFjdGlvbmFsIHNlY29uZHMuXG4gKiBAcGFyYW0geWVhciBudW1lcmljIHllYXJcbiAqIEBwYXJhbSBtb250aCBudW1lcmljIG1vbnRoLCAxLWluZGV4ZWRcbiAqIEBwYXJhbSBkYXkgbnVtZXJpYyB5ZWFyXG4gKiBAcGFyYW0gbWF0Y2ggbWF0Y2ggd2l0aCBncm91cHMgXCJIXCIsIFwibVwiLCBzXCIsIGFuZCBcImZyYWNcIlxuICovXG5jb25zdCBidWlsZERhdGUgPSAoeWVhcjogbnVtYmVyLCBtb250aDogbnVtYmVyLCBkYXk6IG51bWJlciwgbWF0Y2g6IFJlZ0V4cE1hdGNoQXJyYXkpOiBEYXRlID0+IHtcbiAgY29uc3QgYWRqdXN0ZWRNb250aCA9IG1vbnRoIC0gMTsgLy8gSmF2YVNjcmlwdCwgYW5kIG91ciBpbnRlcm5hbCBkYXRhIHN0cnVjdHVyZXMsIGV4cGVjdCAwLWluZGV4ZWQgbW9udGhzXG4gIHZhbGlkYXRlRGF5T2ZNb250aCh5ZWFyLCBhZGp1c3RlZE1vbnRoLCBkYXkpO1xuICAvLyBBZGp1c3QgbW9udGggZG93biBieSAxXG4gIHJldHVybiBuZXcgRGF0ZShcbiAgICBEYXRlLlVUQyhcbiAgICAgIHllYXIsXG4gICAgICBhZGp1c3RlZE1vbnRoLFxuICAgICAgZGF5LFxuICAgICAgcGFyc2VEYXRlVmFsdWUobWF0Y2guZ3JvdXBzIVtcIkhcIl0hLCBcImhvdXJcIiwgMCwgMjMpLFxuICAgICAgcGFyc2VEYXRlVmFsdWUobWF0Y2guZ3JvdXBzIVtcIm1cIl0hLCBcIm1pbnV0ZVwiLCAwLCA1OSksXG4gICAgICAvLyBzZWNvbmRzIGNhbiBnbyB1cCB0byA2MCBmb3IgbGVhcCBzZWNvbmRzXG4gICAgICBwYXJzZURhdGVWYWx1ZShtYXRjaC5ncm91cHMhW1wic1wiXSEsIFwic2Vjb25kc1wiLCAwLCA2MCksXG4gICAgICBwYXJzZU1pbGxpc2Vjb25kcyhtYXRjaC5ncm91cHMhW1wiZnJhY1wiXSlcbiAgICApXG4gICk7XG59O1xuXG4vKipcbiAqIFJGQyA4NTAgZGF0ZXMgdXNlIGEgMi1kaWdpdCB5ZWFyOyBzdGFydCB3aXRoIHRoZSBhc3N1bXB0aW9uIHRoYXQgaWYgaXQgZG9lc24ndFxuICogbWF0Y2ggdGhlIGN1cnJlbnQgeWVhciwgdGhlbiBpdCdzIGEgZGF0ZSBpbiB0aGUgZnV0dXJlLCB0aGVuIGxldCBhZGp1c3RSZmM4NTBZZWFyIGFkanVzdFxuICogdGhlIGZpbmFsIGRhdGUgYmFjayB0byB0aGUgcGFzdCBpZiBpdCdzIHRvbyBmYXIgaW4gdGhlIGZ1dHVyZS5cbiAqXG4gKiBFeGFtcGxlOiBpbiAyMDIxLCBzdGFydCB3aXRoIHRoZSBhc3N1bXB0aW9uIHRoYXQgJzExJyBpcyAnMjExMScsIGFuZCB0aGF0ICcyMicgaXMgJzIwMjInLlxuICogYWRqdXN0UmZjODUwWWVhciB3aWxsIGFkanVzdCAnMTEnIHRvIDIwMTEsIChhcyAyMTExIGlzIG1vcmUgdGhhbiA1MCB5ZWFycyBpbiB0aGUgZnV0dXJlKSxcbiAqIGJ1dCBrZWVwICcyMicgYXMgMjAyMi4gaW4gMjA5OSwgJzExJyB3aWxsIHJlcHJlc2VudCAnMjExMScsIGJ1dCAnOTgnIHNob3VsZCBiZSAnMjA5OCcuXG4gKiBUaGVyZSdzIG5vIGRlc2NyaXB0aW9uIG9mIGFuIFJGQyA4NTAgZGF0ZSBiZWluZyBjb25zaWRlcmVkIHRvbyBmYXIgaW4gdGhlIHBhc3QgaW4gUkZDLTcyMzEsXG4gKiBzbyBpdCdzIGVudGlyZWx5IHBvc3NpYmxlIHRoYXQgMjAxMSBpcyBhIHZhbGlkIGludGVycHJldGF0aW9uIG9mICcxMScgaW4gMjA5OS5cbiAqIEBwYXJhbSB2YWx1ZSB0aGUgMiBkaWdpdCB5ZWFyIHRvIHBhcnNlXG4gKiBAcmV0dXJuIG51bWJlciBhIHllYXIgdGhhdCBpcyBlcXVhbCB0byBvciBncmVhdGVyIHRoYW4gdGhlIGN1cnJlbnQgVVRDIHllYXJcbiAqL1xuY29uc3QgcGFyc2VUd29EaWdpdFllYXIgPSAodmFsdWU6IHN0cmluZyk6IG51bWJlciA9PiB7XG4gIGNvbnN0IHRoaXNZZWFyID0gbmV3IERhdGUoKS5nZXRVVENGdWxsWWVhcigpO1xuICBjb25zdCB2YWx1ZUluVGhpc0NlbnR1cnkgPSBNYXRoLmZsb29yKHRoaXNZZWFyIC8gMTAwKSAqIDEwMCArIHN0cmljdFBhcnNlU2hvcnQoc3RyaXBMZWFkaW5nWmVyb2VzKHZhbHVlKSkhO1xuICBpZiAodmFsdWVJblRoaXNDZW50dXJ5IDwgdGhpc1llYXIpIHtcbiAgICAvLyBUaGlzIG1heSBlbmQgdXAgcmV0dXJuaW5nIGEgeWVhciB0aGF0IGFkanVzdFJmYzg1MFllYXIgdHVybnMgYmFjayBieSAxMDAuXG4gICAgLy8gVGhhdCdzIGZpbmUhIFdlIGRvbid0IGtub3cgdGhlIG90aGVyIGNvbXBvbmVudHMgb2YgdGhlIGRhdGUgeWV0LCBzbyB0aGVyZSBhcmVcbiAgICAvLyBib3VuZGFyeSBjb25kaXRpb25zIHRoYXQgb25seSBhZGp1c3RSZmM4NTBZZWFyIGNhbiBoYW5kbGUuXG4gICAgcmV0dXJuIHZhbHVlSW5UaGlzQ2VudHVyeSArIDEwMDtcbiAgfVxuICByZXR1cm4gdmFsdWVJblRoaXNDZW50dXJ5O1xufTtcblxuY29uc3QgRklGVFlfWUVBUlNfSU5fTUlMTElTID0gNTAgKiAzNjUgKiAyNCAqIDYwICogNjAgKiAxMDAwO1xuXG4vKipcbiAqIEFkanVzdHMgdGhlIHllYXIgdmFsdWUgZm91bmQgaW4gUkZDIDg1MCBkYXRlcyBhY2NvcmRpbmcgdG8gdGhlIHJ1bGVzXG4gKiBleHByZXNzZWQgaW4gUkZDNzIzMSwgd2hpY2ggc3RhdGU6XG4gKlxuICogPGJsb2NrcXVvdGU+UmVjaXBpZW50cyBvZiBhIHRpbWVzdGFtcCB2YWx1ZSBpbiByZmM4NTAtZGF0ZSBmb3JtYXQsIHdoaWNoIHVzZXMgYVxuICogdHdvLWRpZ2l0IHllYXIsIE1VU1QgaW50ZXJwcmV0IGEgdGltZXN0YW1wIHRoYXQgYXBwZWFycyB0byBiZSBtb3JlXG4gKiB0aGFuIDUwIHllYXJzIGluIHRoZSBmdXR1cmUgYXMgcmVwcmVzZW50aW5nIHRoZSBtb3N0IHJlY2VudCB5ZWFyIGluXG4gKiB0aGUgcGFzdCB0aGF0IGhhZCB0aGUgc2FtZSBsYXN0IHR3byBkaWdpdHMuPC9ibG9ja3F1b3RlPlxuICpcbiAqIEBwYXJhbSBpbnB1dCBhIERhdGUgdGhhdCBhc3N1bWVzIHRoZSB0d28tZGlnaXQgeWVhciB3YXMgaW4gdGhlIGZ1dHVyZVxuICogQHJldHVybiBhIERhdGUgdGhhdCBpcyBpbiB0aGUgcGFzdCBpZiBpbnB1dCBpcyA+IDUwIHllYXJzIGluIHRoZSBmdXR1cmVcbiAqL1xuY29uc3QgYWRqdXN0UmZjODUwWWVhciA9IChpbnB1dDogRGF0ZSk6IERhdGUgPT4ge1xuICBpZiAoaW5wdXQuZ2V0VGltZSgpIC0gbmV3IERhdGUoKS5nZXRUaW1lKCkgPiBGSUZUWV9ZRUFSU19JTl9NSUxMSVMpIHtcbiAgICByZXR1cm4gbmV3IERhdGUoXG4gICAgICBEYXRlLlVUQyhcbiAgICAgICAgaW5wdXQuZ2V0VVRDRnVsbFllYXIoKSAtIDEwMCxcbiAgICAgICAgaW5wdXQuZ2V0VVRDTW9udGgoKSxcbiAgICAgICAgaW5wdXQuZ2V0VVRDRGF0ZSgpLFxuICAgICAgICBpbnB1dC5nZXRVVENIb3VycygpLFxuICAgICAgICBpbnB1dC5nZXRVVENNaW51dGVzKCksXG4gICAgICAgIGlucHV0LmdldFVUQ1NlY29uZHMoKSxcbiAgICAgICAgaW5wdXQuZ2V0VVRDTWlsbGlzZWNvbmRzKClcbiAgICAgIClcbiAgICApO1xuICB9XG4gIHJldHVybiBpbnB1dDtcbn07XG5cbmNvbnN0IHBhcnNlTW9udGhCeVNob3J0TmFtZSA9ICh2YWx1ZTogc3RyaW5nKTogbnVtYmVyID0+IHtcbiAgY29uc3QgbW9udGhJZHggPSBNT05USFMuaW5kZXhPZih2YWx1ZSk7XG4gIGlmIChtb250aElkeCA8IDApIHtcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKGBJbnZhbGlkIG1vbnRoOiAke3ZhbHVlfWApO1xuICB9XG4gIHJldHVybiBtb250aElkeCArIDE7XG59O1xuXG5jb25zdCBEQVlTX0lOX01PTlRIID0gWzMxLCAyOCwgMzEsIDMwLCAzMSwgMzAsIDMxLCAzMSwgMzAsIDMxLCAzMCwgMzFdO1xuXG4vKipcbiAqIFZhbGlkYXRlIHRoZSBkYXkgaXMgdmFsaWQgZm9yIHRoZSBnaXZlbiBtb250aC5cbiAqIEBwYXJhbSB5ZWFyIHRoZSB5ZWFyXG4gKiBAcGFyYW0gbW9udGggdGhlIG1vbnRoICgwLWluZGV4ZWQpXG4gKiBAcGFyYW0gZGF5IHRoZSBkYXkgb2YgdGhlIG1vbnRoXG4gKi9cbmNvbnN0IHZhbGlkYXRlRGF5T2ZNb250aCA9ICh5ZWFyOiBudW1iZXIsIG1vbnRoOiBudW1iZXIsIGRheTogbnVtYmVyKSA9PiB7XG4gIGxldCBtYXhEYXlzID0gREFZU19JTl9NT05USFttb250aF07XG4gIGlmIChtb250aCA9PT0gMSAmJiBpc0xlYXBZZWFyKHllYXIpKSB7XG4gICAgbWF4RGF5cyA9IDI5O1xuICB9XG5cbiAgaWYgKGRheSA+IG1heERheXMpIHtcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKGBJbnZhbGlkIGRheSBmb3IgJHtNT05USFNbbW9udGhdfSBpbiAke3llYXJ9OiAke2RheX1gKTtcbiAgfVxufTtcblxuY29uc3QgaXNMZWFwWWVhciA9ICh5ZWFyOiBudW1iZXIpOiBib29sZWFuID0+IHtcbiAgcmV0dXJuIHllYXIgJSA0ID09PSAwICYmICh5ZWFyICUgMTAwICE9PSAwIHx8IHllYXIgJSA0MDAgPT09IDApO1xufTtcblxuY29uc3QgcGFyc2VEYXRlVmFsdWUgPSAodmFsdWU6IHN0cmluZywgdHlwZTogc3RyaW5nLCBsb3dlcjogbnVtYmVyLCB1cHBlcjogbnVtYmVyKTogbnVtYmVyID0+IHtcbiAgY29uc3QgZGF0ZVZhbCA9IHN0cmljdFBhcnNlQnl0ZShzdHJpcExlYWRpbmdaZXJvZXModmFsdWUpKSE7XG4gIGlmIChkYXRlVmFsIDwgbG93ZXIgfHwgZGF0ZVZhbCA+IHVwcGVyKSB7XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcihgJHt0eXBlfSBtdXN0IGJlIGJldHdlZW4gJHtsb3dlcn0gYW5kICR7dXBwZXJ9LCBpbmNsdXNpdmVgKTtcbiAgfVxuICByZXR1cm4gZGF0ZVZhbDtcbn07XG5cbmNvbnN0IHBhcnNlTWlsbGlzZWNvbmRzID0gKHZhbHVlOiBzdHJpbmcgfCB1bmRlZmluZWQpOiBudW1iZXIgPT4ge1xuICBpZiAodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgIHJldHVybiAwO1xuICB9XG5cbiAgcmV0dXJuIHN0cmljdFBhcnNlRmxvYXQzMihcIjAuXCIgKyB2YWx1ZSkhICogMTAwMDtcbn07XG5cbmNvbnN0IHN0cmlwTGVhZGluZ1plcm9lcyA9ICh2YWx1ZTogc3RyaW5nKTogc3RyaW5nID0+IHtcbiAgbGV0IGlkeCA9IDA7XG4gIHdoaWxlIChpZHggPCB2YWx1ZS5sZW5ndGggLSAxICYmIHZhbHVlLmNoYXJBdChpZHgpID09PSBcIjBcIikge1xuICAgIGlkeCsrO1xuICB9XG4gIGlmIChpZHggPT09IDApIHtcbiAgICByZXR1cm4gdmFsdWU7XG4gIH1cbiAgcmV0dXJuIHZhbHVlLnNsaWNlKGlkeCk7XG59O1xuIl19