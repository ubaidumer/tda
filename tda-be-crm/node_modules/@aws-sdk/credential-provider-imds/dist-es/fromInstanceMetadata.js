import { __assign, __awaiter, __generator } from "tslib";
import { CredentialsProviderError } from "@aws-sdk/property-provider";
import { httpRequest } from "./remoteProvider/httpRequest";
import { fromImdsCredentials, isImdsCredentials } from "./remoteProvider/ImdsCredentials";
import { providerConfigFromInit } from "./remoteProvider/RemoteProviderInit";
import { retry } from "./remoteProvider/retry";
import { getInstanceMetadataEndpoint } from "./utils/getInstanceMetadataEndpoint";
var IMDS_PATH = "/latest/meta-data/iam/security-credentials/";
var IMDS_TOKEN_PATH = "/latest/api/token";
export var fromInstanceMetadata = function (init) {
    if (init === void 0) { init = {}; }
    var disableFetchToken = false;
    var _a = providerConfigFromInit(init), timeout = _a.timeout, maxRetries = _a.maxRetries;
    var getCredentials = function (maxRetries, options) { return __awaiter(void 0, void 0, void 0, function () {
        var profile;
        return __generator(this, function (_a) {
            switch (_a.label) {
                case 0: return [4, retry(function () { return __awaiter(void 0, void 0, void 0, function () {
                        var profile, err_1;
                        return __generator(this, function (_a) {
                            switch (_a.label) {
                                case 0:
                                    _a.trys.push([0, 2, , 3]);
                                    return [4, getProfile(options)];
                                case 1:
                                    profile = _a.sent();
                                    return [3, 3];
                                case 2:
                                    err_1 = _a.sent();
                                    if (err_1.statusCode === 401) {
                                        disableFetchToken = false;
                                    }
                                    throw err_1;
                                case 3: return [2, profile];
                            }
                        });
                    }); }, maxRetries)];
                case 1:
                    profile = (_a.sent()).trim();
                    return [2, retry(function () { return __awaiter(void 0, void 0, void 0, function () {
                            var creds, err_2;
                            return __generator(this, function (_a) {
                                switch (_a.label) {
                                    case 0:
                                        _a.trys.push([0, 2, , 3]);
                                        return [4, getCredentialsFromProfile(profile, options)];
                                    case 1:
                                        creds = _a.sent();
                                        return [3, 3];
                                    case 2:
                                        err_2 = _a.sent();
                                        if (err_2.statusCode === 401) {
                                            disableFetchToken = false;
                                        }
                                        throw err_2;
                                    case 3: return [2, creds];
                                }
                            });
                        }); }, maxRetries)];
            }
        });
    }); };
    return function () { return __awaiter(void 0, void 0, void 0, function () {
        var endpoint, token, error_1;
        return __generator(this, function (_a) {
            switch (_a.label) {
                case 0: return [4, getInstanceMetadataEndpoint()];
                case 1:
                    endpoint = _a.sent();
                    if (!disableFetchToken) return [3, 2];
                    return [2, getCredentials(maxRetries, __assign(__assign({}, endpoint), { timeout: timeout }))];
                case 2:
                    token = void 0;
                    _a.label = 3;
                case 3:
                    _a.trys.push([3, 5, , 6]);
                    return [4, getMetadataToken(__assign(__assign({}, endpoint), { timeout: timeout }))];
                case 4:
                    token = (_a.sent()).toString();
                    return [3, 6];
                case 5:
                    error_1 = _a.sent();
                    if ((error_1 === null || error_1 === void 0 ? void 0 : error_1.statusCode) === 400) {
                        throw Object.assign(error_1, {
                            message: "EC2 Metadata token request returned error",
                        });
                    }
                    else if (error_1.message === "TimeoutError" || [403, 404, 405].includes(error_1.statusCode)) {
                        disableFetchToken = true;
                    }
                    return [2, getCredentials(maxRetries, __assign(__assign({}, endpoint), { timeout: timeout }))];
                case 6: return [2, getCredentials(maxRetries, __assign(__assign({}, endpoint), { headers: {
                            "x-aws-ec2-metadata-token": token,
                        }, timeout: timeout }))];
            }
        });
    }); };
};
var getMetadataToken = function (options) { return __awaiter(void 0, void 0, void 0, function () {
    return __generator(this, function (_a) {
        return [2, httpRequest(__assign(__assign({}, options), { path: IMDS_TOKEN_PATH, method: "PUT", headers: {
                    "x-aws-ec2-metadata-token-ttl-seconds": "21600",
                } }))];
    });
}); };
var getProfile = function (options) { return __awaiter(void 0, void 0, void 0, function () { return __generator(this, function (_a) {
    switch (_a.label) {
        case 0: return [4, httpRequest(__assign(__assign({}, options), { path: IMDS_PATH }))];
        case 1: return [2, (_a.sent()).toString()];
    }
}); }); };
var getCredentialsFromProfile = function (profile, options) { return __awaiter(void 0, void 0, void 0, function () {
    var credsResponse, _a, _b;
    return __generator(this, function (_c) {
        switch (_c.label) {
            case 0:
                _b = (_a = JSON).parse;
                return [4, httpRequest(__assign(__assign({}, options), { path: IMDS_PATH + profile }))];
            case 1:
                credsResponse = _b.apply(_a, [(_c.sent()).toString()]);
                if (!isImdsCredentials(credsResponse)) {
                    throw new CredentialsProviderError("Invalid response received from instance metadata service.");
                }
                return [2, fromImdsCredentials(credsResponse)];
        }
    });
}); };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZnJvbUluc3RhbmNlTWV0YWRhdGEuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvZnJvbUluc3RhbmNlTWV0YWRhdGEudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBSXRFLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUMzRCxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUMxRixPQUFPLEVBQUUsc0JBQXNCLEVBQXNCLE1BQU0scUNBQXFDLENBQUM7QUFDakcsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQy9DLE9BQU8sRUFBRSwyQkFBMkIsRUFBRSxNQUFNLHFDQUFxQyxDQUFDO0FBRWxGLElBQU0sU0FBUyxHQUFHLDZDQUE2QyxDQUFDO0FBQ2hFLElBQU0sZUFBZSxHQUFHLG1CQUFtQixDQUFDO0FBTTVDLE1BQU0sQ0FBQyxJQUFNLG9CQUFvQixHQUFHLFVBQUMsSUFBNkI7SUFBN0IscUJBQUEsRUFBQSxTQUE2QjtJQUVoRSxJQUFJLGlCQUFpQixHQUFHLEtBQUssQ0FBQztJQUN4QixJQUFBLEtBQTBCLHNCQUFzQixDQUFDLElBQUksQ0FBQyxFQUFwRCxPQUFPLGFBQUEsRUFBRSxVQUFVLGdCQUFpQyxDQUFDO0lBRTdELElBQU0sY0FBYyxHQUFHLFVBQU8sVUFBa0IsRUFBRSxPQUF1Qjs7Ozt3QkFFckUsV0FBTSxLQUFLLENBQVM7Ozs7OztvQ0FHTixXQUFNLFVBQVUsQ0FBQyxPQUFPLENBQUMsRUFBQTs7b0NBQW5DLE9BQU8sR0FBRyxTQUF5QixDQUFDOzs7O29DQUVwQyxJQUFJLEtBQUcsQ0FBQyxVQUFVLEtBQUssR0FBRyxFQUFFO3dDQUMxQixpQkFBaUIsR0FBRyxLQUFLLENBQUM7cUNBQzNCO29DQUNELE1BQU0sS0FBRyxDQUFDO3dDQUVaLFdB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QkFBbUIsQ0FBQyxhQUFhLENBQUMsRUFBQzs7O0tBQzNDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDcmVkZW50aWFsc1Byb3ZpZGVyRXJyb3IgfSBmcm9tIFwiQGF3cy1zZGsvcHJvcGVydHktcHJvdmlkZXJcIjtcbmltcG9ydCB7IENyZWRlbnRpYWxQcm92aWRlciwgQ3JlZGVudGlhbHMgfSBmcm9tIFwiQGF3cy1zZGsvdHlwZXNcIjtcbmltcG9ydCB7IFJlcXVlc3RPcHRpb25zIH0gZnJvbSBcImh0dHBcIjtcblxuaW1wb3J0IHsgaHR0cFJlcXVlc3QgfSBmcm9tIFwiLi9yZW1vdGVQcm92aWRlci9odHRwUmVxdWVzdFwiO1xuaW1wb3J0IHsgZnJvbUltZHNDcmVkZW50aWFscywgaXNJbWRzQ3JlZGVudGlhbHMgfSBmcm9tIFwiLi9yZW1vdGVQcm92aWRlci9JbWRzQ3JlZGVudGlhbHNcIjtcbmltcG9ydCB7IHByb3ZpZGVyQ29uZmlnRnJvbUluaXQsIFJlbW90ZVByb3ZpZGVySW5pdCB9IGZyb20gXCIuL3JlbW90ZVByb3ZpZGVyL1JlbW90ZVByb3ZpZGVySW5pdFwiO1xuaW1wb3J0IHsgcmV0cnkgfSBmcm9tIFwiLi9yZW1vdGVQcm92aWRlci9yZXRyeVwiO1xuaW1wb3J0IHsgZ2V0SW5zdGFuY2VNZXRhZGF0YUVuZHBvaW50IH0gZnJvbSBcIi4vdXRpbHMvZ2V0SW5zdGFuY2VNZXRhZGF0YUVuZHBvaW50XCI7XG5cbmNvbnN0IElNRFNfUEFUSCA9IFwiL2xhdGVzdC9tZXRhLWRhdGEvaWFtL3NlY3VyaXR5LWNyZWRlbnRpYWxzL1wiO1xuY29uc3QgSU1EU19UT0tFTl9QQVRIID0gXCIvbGF0ZXN0L2FwaS90b2tlblwiO1xuXG4vKipcbiAqIENyZWF0ZXMgYSBjcmVkZW50aWFsIHByb3ZpZGVyIHRoYXQgd2lsbCBzb3VyY2UgY3JlZGVudGlhbHMgZnJvbSB0aGUgRUMyXG4gKiBJbnN0YW5jZSBNZXRhZGF0YSBTZXJ2aWNlXG4gKi9cbmV4cG9ydCBjb25zdCBmcm9tSW5zdGFuY2VNZXRhZGF0YSA9IChpbml0OiBSZW1vdGVQcm92aWRlckluaXQgPSB7fSk6IENyZWRlbnRpYWxQcm92aWRlciA9PiB7XG4gIC8vIHdoZW4gc2V0IHRvIHRydWUsIG1ldGFkYXRhIHNlcnZpY2Ugd2lsbCBub3QgZmV0Y2ggdG9rZW5cbiAgbGV0IGRpc2FibGVGZXRjaFRva2VuID0gZmFsc2U7XG4gIGNvbnN0IHsgdGltZW91dCwgbWF4UmV0cmllcyB9ID0gcHJvdmlkZXJDb25maWdGcm9tSW5pdChpbml0KTtcblxuICBjb25zdCBnZXRDcmVkZW50aWFscyA9IGFzeW5jIChtYXhSZXRyaWVzOiBudW1iZXIsIG9wdGlvbnM6IFJlcXVlc3RPcHRpb25zKSA9PiB7XG4gICAgY29uc3QgcHJvZmlsZSA9IChcbiAgICAgIGF3YWl0IHJldHJ5PHN0cmluZz4oYXN5bmMgKCkgPT4ge1xuICAgICAgICBsZXQgcHJvZmlsZTogc3RyaW5nO1xuICAgICAgICB0cnkge1xuICAgICAgICAgIHByb2ZpbGUgPSBhd2FpdCBnZXRQcm9maWxlKG9wdGlvbnMpO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICBpZiAoZXJyLnN0YXR1c0NvZGUgPT09IDQwMSkge1xuICAgICAgICAgICAgZGlzYWJsZUZldGNoVG9rZW4gPSBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBwcm9maWxlO1xuICAgICAgfSwgbWF4UmV0cmllcylcbiAgICApLnRyaW0oKTtcblxuICAgIHJldHVybiByZXRyeShhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgY3JlZHM6IENyZWRlbnRpYWxzO1xuICAgICAgdHJ5IHtcbiAgICAgICAgY3JlZHMgPSBhd2FpdCBnZXRDcmVkZW50aWFsc0Zyb21Qcm9maWxlKHByb2ZpbGUsIG9wdGlvbnMpO1xuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGlmIChlcnIuc3RhdHVzQ29kZSA9PT0gNDAxKSB7XG4gICAgICAgICAgZGlzYWJsZUZldGNoVG9rZW4gPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICB0aHJvdyBlcnI7XG4gICAgICB9XG4gICAgICByZXR1cm4gY3JlZHM7XG4gICAgfSwgbWF4UmV0cmllcyk7XG4gIH07XG5cbiAgcmV0dXJuIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBlbmRwb2ludCA9IGF3YWl0IGdldEluc3RhbmNlTWV0YWRhdGFFbmRwb2ludCgpO1xuICAgIGlmIChkaXNhYmxlRmV0Y2hUb2tlbikge1xuICAgICAgcmV0dXJuIGdldENyZWRlbnRpYWxzKG1heFJldHJpZXMsIHsgLi4uZW5kcG9pbnQsIHRpbWVvdXQgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxldCB0b2tlbjogc3RyaW5nO1xuICAgICAgdHJ5IHtcbiAgICAgICAgdG9rZW4gPSAoYXdhaXQgZ2V0TWV0YWRhdGFUb2tlbih7IC4uLmVuZHBvaW50LCB0aW1lb3V0IH0pKS50b1N0cmluZygpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgaWYgKGVycm9yPy5zdGF0dXNDb2RlID09PSA0MDApIHtcbiAgICAgICAgICB0aHJvdyBPYmplY3QuYXNzaWduKGVycm9yLCB7XG4gICAgICAgICAgICBtZXNzYWdlOiBcIkVDMiBNZXRhZGF0YSB0b2tlbiByZXF1ZXN0IHJldHVybmVkIGVycm9yXCIsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSBpZiAoZXJyb3IubWVzc2FnZSA9PT0gXCJUaW1lb3V0RXJyb3JcIiB8fCBbNDAzLCA0MDQsIDQwNV0uaW5jbHVkZXMoZXJyb3Iuc3RhdHVzQ29kZSkpIHtcbiAgICAgICAgICBkaXNhYmxlRmV0Y2hUb2tlbiA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGdldENyZWRlbnRpYWxzKG1heFJldHJpZXMsIHsgLi4uZW5kcG9pbnQsIHRpbWVvdXQgfSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gZ2V0Q3JlZGVudGlhbHMobWF4UmV0cmllcywge1xuICAgICAgICAuLi5lbmRwb2ludCxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgIFwieC1hd3MtZWMyLW1ldGFkYXRhLXRva2VuXCI6IHRva2VuLFxuICAgICAgICB9LFxuICAgICAgICB0aW1lb3V0LFxuICAgICAgfSk7XG4gICAgfVxuICB9O1xufTtcblxuY29uc3QgZ2V0TWV0YWRhdGFUb2tlbiA9IGFzeW5jIChvcHRpb25zOiBSZXF1ZXN0T3B0aW9ucykgPT5cbiAgaHR0cFJlcXVlc3Qoe1xuICAgIC4uLm9wdGlvbnMsXG4gICAgcGF0aDogSU1EU19UT0tFTl9QQVRILFxuICAgIG1ldGhvZDogXCJQVVRcIixcbiAgICBoZWFkZXJzOiB7XG4gICAgICBcIngtYXdzLWVjMi1tZXRhZGF0YS10b2tlbi10dGwtc2Vjb25kc1wiOiBcIjIxNjAwXCIsXG4gICAgfSxcbiAgfSk7XG5cbmNvbnN0IGdldFByb2ZpbGUgPSBhc3luYyAob3B0aW9uczogUmVxdWVzdE9wdGlvbnMpID0+IChhd2FpdCBodHRwUmVxdWVzdCh7IC4uLm9wdGlvbnMsIHBhdGg6IElNRFNfUEFUSCB9KSkudG9TdHJpbmcoKTtcblxuY29uc3QgZ2V0Q3JlZGVudGlhbHNGcm9tUHJvZmlsZSA9IGFzeW5jIChwcm9maWxlOiBzdHJpbmcsIG9wdGlvbnM6IFJlcXVlc3RPcHRpb25zKSA9PiB7XG4gIGNvbnN0IGNyZWRzUmVzcG9uc2UgPSBKU09OLnBhcnNlKFxuICAgIChcbiAgICAgIGF3YWl0IGh0dHBSZXF1ZXN0KHtcbiAgICAgICAgLi4ub3B0aW9ucyxcbiAgICAgICAgcGF0aDogSU1EU19QQVRIICsgcHJvZmlsZSxcbiAgICAgIH0pXG4gICAgKS50b1N0cmluZygpXG4gICk7XG5cbiAgaWYgKCFpc0ltZHNDcmVkZW50aWFscyhjcmVkc1Jlc3BvbnNlKSkge1xuICAgIHRocm93IG5ldyBDcmVkZW50aWFsc1Byb3ZpZGVyRXJyb3IoXCJJbnZhbGlkIHJlc3BvbnNlIHJlY2VpdmVkIGZyb20gaW5zdGFuY2UgbWV0YWRhdGEgc2VydmljZS5cIik7XG4gIH1cblxuICByZXR1cm4gZnJvbUltZHNDcmVkZW50aWFscyhjcmVkc1Jlc3BvbnNlKTtcbn07XG4iXX0=