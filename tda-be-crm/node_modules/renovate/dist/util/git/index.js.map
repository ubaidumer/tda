{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../lib/util/git/index.ts"],"names":[],"mappings":"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","sourcesContent":["import URL from 'url';\nimport fs from 'fs-extra';\nimport Git, { Options, ResetMode, SimpleGit, TaskOptions } from 'simple-git';\nimport { join } from 'upath';\nimport { configFileNames } from '../../config/app-strings';\nimport { GlobalConfig } from '../../config/global';\nimport type { RenovateConfig } from '../../config/types';\nimport {\n  CONFIG_VALIDATION,\n  REPOSITORY_CHANGED,\n  REPOSITORY_DISABLED,\n  REPOSITORY_EMPTY,\n  SYSTEM_INSUFFICIENT_DISK_SPACE,\n  TEMPORARY_ERROR,\n} from '../../constants/error-messages';\nimport { logger } from '../../logger';\nimport { ExternalHostError } from '../../types/errors/external-host-error';\nimport type { GitProtocol } from '../../types/git';\nimport { Limit, incLimitedValue } from '../../workers/global/limits';\nimport { regEx } from '../regex';\nimport { parseGitAuthor } from './author';\nimport { getNoVerify, simpleGitConfig } from './config';\nimport { configSigningKey, writePrivateKey } from './private-key';\nimport type {\n  CommitFilesConfig,\n  CommitSha,\n  LocalConfig,\n  StatusResult,\n  StorageConfig,\n} from './types';\n\nexport { setNoVerify } from './config';\nexport { setPrivateKey } from './private-key';\n\ndeclare module 'fs-extra' {\n  export function exists(pathLike: string): Promise<boolean>;\n}\n\n// istanbul ignore next\nfunction checkForPlatformFailure(err: Error): void {\n  if (process.env.NODE_ENV === 'test') {\n    return;\n  }\n  const externalHostFailureStrings = [\n    'remote: Invalid username or password',\n    'gnutls_handshake() failed',\n    'The requested URL returned error: 5',\n    'The remote end hung up unexpectedly',\n    'access denied or repository not exported',\n    'Could not write new index file',\n    'Failed to connect to',\n    'Connection timed out',\n    'malformed object name',\n    'Could not resolve host',\n    'early EOF',\n    'fatal: bad config', // .gitmodules problem\n    'expected flush after ref listing',\n  ];\n  for (const errorStr of externalHostFailureStrings) {\n    if (err.message.includes(errorStr)) {\n      logger.debug({ err }, 'Converting git error to ExternalHostError');\n      throw new ExternalHostError(err, 'git');\n    }\n  }\n\n  const configErrorStrings = [\n    {\n      error: 'GitLab: Branch name does not follow the pattern',\n      message:\n        \"Cannot push because branch name does not follow project's push rules\",\n    },\n    {\n      error: 'GitLab: Commit message does not follow the pattern',\n      message:\n        \"Cannot push because commit message does not follow project's push rules\",\n    },\n    {\n      error: ' is not a member of team',\n      message:\n        'The `Restrict commits to existing GitLab users` rule is blocking Renovate push. Check the Renovate `gitAuthor` setting',\n    },\n    {\n      error: 'TF401027:',\n      message:\n        'You need the Git `GenericContribute` permission to perform this action',\n    },\n    {\n      error: 'matches more than one',\n      message:\n        \"Renovate cannot push branches if there are tags with names the same as Renovate's branches. Please remove conflicting tag names or change Renovate's branchPrefix to avoid conflicts.\",\n    },\n  ];\n  for (const { error, message } of configErrorStrings) {\n    if (err.message.includes(error)) {\n      logger.debug({ err }, 'Converting git error to CONFIG_VALIDATION error');\n      const res = new Error(CONFIG_VALIDATION);\n      res.validationError = message;\n      res.validationMessage = err.message;\n      throw res;\n    }\n  }\n}\n\nfunction localName(branchName: string): string {\n  return branchName.replace(regEx(/^origin\\//), ''); // TODO #12071\n}\n\nasync function isDirectory(dir: string): Promise<boolean> {\n  try {\n    return (await fs.stat(dir)).isDirectory();\n  } catch (err) {\n    return false;\n  }\n}\n\nasync function getDefaultBranch(git: SimpleGit): Promise<string> {\n  // see https://stackoverflow.com/a/62352647/3005034\n  try {\n    const res = await git.raw(['rev-parse', '--abbrev-ref', 'origin/HEAD']);\n    return res.replace('origin/', '').trim();\n  } catch (err) /* istanbul ignore next */ {\n    checkForPlatformFailure(err);\n    if (\n      err.message.startsWith(\n        'fatal: ref refs/remotes/origin/HEAD is not a symbolic ref'\n      )\n    ) {\n      throw new Error(REPOSITORY_EMPTY);\n    }\n    // istanbul ignore if\n    if (err.message.includes(\"fatal: ambiguous argument 'origin/HEAD'\")) {\n      logger.warn({ err }, 'Error getting default branch');\n      throw new Error(TEMPORARY_ERROR);\n    }\n    throw err;\n  }\n}\n\nlet config: LocalConfig = {} as any;\n\nlet git: SimpleGit | undefined;\nlet gitInitialized: boolean;\n\nlet privateKeySet = false;\n\nasync function fetchBranchCommits(): Promise<void> {\n  config.branchCommits = {};\n  const opts = ['ls-remote', '--heads', config.url];\n  if (config.extraCloneOpts) {\n    Object.entries(config.extraCloneOpts).forEach((e) =>\n      opts.unshift(e[0], `${e[1]}`)\n    );\n  }\n  try {\n    (await git.raw(opts))\n      .split('\\n')\n      .filter(Boolean)\n      .map((line) => line.trim().split(regEx(/\\s+/))) // TODO #12071\n      .forEach(([sha, ref]) => {\n        config.branchCommits[ref.replace('refs/heads/', '')] = sha;\n      });\n  } catch (err) /* istanbul ignore next */ {\n    checkForPlatformFailure(err);\n    logger.debug({ err }, 'git error');\n    if (err.message?.includes('Please ask the owner to check their account')) {\n      throw new Error(REPOSITORY_DISABLED);\n    }\n    throw err;\n  }\n}\n\nexport async function initRepo(args: StorageConfig): Promise<void> {\n  config = { ...args } as any;\n  config.ignoredAuthors = [];\n  config.additionalBranches = [];\n  config.branchIsModified = {};\n  const { localDir } = GlobalConfig.get();\n  git = Git(localDir, simpleGitConfig());\n  gitInitialized = false;\n  await fetchBranchCommits();\n}\n\nasync function resetToBranch(branchName: string): Promise<void> {\n  logger.debug(`resetToBranch(${branchName})`);\n  await git.raw(['reset', '--hard']);\n  await git.checkout(branchName);\n  await git.raw(['reset', '--hard', 'origin/' + branchName]);\n  await git.raw(['clean', '-fd']);\n}\n\nasync function deleteLocalBranch(branchName: string): Promise<void> {\n  await git.branch(['-D', branchName]);\n}\n\nasync function cleanLocalBranches(): Promise<void> {\n  const existingBranches = (await git.raw(['branch']))\n    .split('\\n')\n    .map((branch) => branch.trim())\n    .filter((branch) => branch.length)\n    .filter((branch) => !branch.startsWith('* '));\n  logger.debug({ existingBranches });\n  for (const branchName of existingBranches) {\n    await deleteLocalBranch(branchName);\n  }\n}\n\nexport function setGitAuthor(gitAuthor: string): void {\n  const gitAuthorParsed = parseGitAuthor(\n    gitAuthor || 'Renovate Bot <renovate@whitesourcesoftware.com>'\n  );\n  if (!gitAuthorParsed) {\n    const error = new Error(CONFIG_VALIDATION);\n    error.validationSource = 'None';\n    error.validationError = 'Invalid gitAuthor';\n    error.validationMessage = `gitAuthor is not parsed as valid RFC5322 format: ${gitAuthor}`;\n    throw error;\n  }\n  config.gitAuthorName = gitAuthorParsed.name;\n  config.gitAuthorEmail = gitAuthorParsed.address;\n}\n\nexport async function writeGitAuthor(): Promise<void> {\n  const { gitAuthorName, gitAuthorEmail } = config;\n  try {\n    if (gitAuthorName) {\n      logger.debug({ gitAuthorName }, 'Setting git author name');\n      await git.addConfig('user.name', gitAuthorName);\n    }\n    if (gitAuthorEmail) {\n      logger.debug({ gitAuthorEmail }, 'Setting git author email');\n      await git.addConfig('user.email', gitAuthorEmail);\n    }\n  } catch (err) /* istanbul ignore next */ {\n    checkForPlatformFailure(err);\n    logger.debug(\n      { err, gitAuthorName, gitAuthorEmail },\n      'Error setting git author config'\n    );\n    throw new Error(TEMPORARY_ERROR);\n  }\n}\n\nexport function setUserRepoConfig({\n  gitIgnoredAuthors,\n  gitAuthor,\n}: RenovateConfig): void {\n  config.ignoredAuthors = gitIgnoredAuthors ?? [];\n  setGitAuthor(gitAuthor);\n}\n\nexport async function getSubmodules(): Promise<string[]> {\n  try {\n    return (\n      (await git.raw([\n        'config',\n        '--file',\n        '.gitmodules',\n        '--get-regexp',\n        '\\\\.path',\n      ])) || ''\n    )\n      .trim()\n      .split(regEx(/[\\n\\s]/))\n      .filter((_e: string, i: number) => i % 2);\n  } catch (err) /* istanbul ignore next */ {\n    logger.warn({ err }, 'Error getting submodules');\n    return [];\n  }\n}\n\nexport async function syncGit(): Promise<void> {\n  if (gitInitialized) {\n    return;\n  }\n  gitInitialized = true;\n  const { localDir } = GlobalConfig.get();\n  logger.debug('Initializing git repository into ' + localDir);\n  const gitHead = join(localDir, '.git/HEAD');\n  let clone = true;\n\n  if (await fs.exists(gitHead)) {\n    try {\n      await git.raw(['remote', 'set-url', 'origin', config.url]);\n      await resetToBranch(await getDefaultBranch(git));\n      const fetchStart = Date.now();\n      await git.pull();\n      await git.fetch();\n      config.currentBranch =\n        config.currentBranch || (await getDefaultBranch(git));\n      await resetToBranch(config.currentBranch);\n      await cleanLocalBranches();\n      await git.raw(['remote', 'prune', 'origin']);\n      const durationMs = Math.round(Date.now() - fetchStart);\n      logger.info({ durationMs }, 'git fetch completed');\n      clone = false;\n    } catch (err) /* istanbul ignore next */ {\n      if (err.message === REPOSITORY_EMPTY) {\n        throw err;\n      }\n      logger.info({ err }, 'git fetch error');\n    }\n  }\n  if (clone) {\n    await fs.emptyDir(localDir);\n    const cloneStart = Date.now();\n    try {\n      const opts = [];\n      if (config.fullClone) {\n        logger.debug('Performing full clone');\n      } else {\n        logger.debug('Performing blobless clone');\n        opts.push('--filter=blob:none');\n      }\n      if (config.extraCloneOpts) {\n        Object.entries(config.extraCloneOpts).forEach((e) =>\n          opts.push(e[0], `${e[1]}`)\n        );\n      }\n      await git.clone(config.url, '.', opts);\n    } catch (err) /* istanbul ignore next */ {\n      logger.debug({ err }, 'git clone error');\n      if (err.message?.includes('No space left on device')) {\n        throw new Error(SYSTEM_INSUFFICIENT_DISK_SPACE);\n      }\n      if (err.message === REPOSITORY_EMPTY) {\n        throw err;\n      }\n      throw new ExternalHostError(err, 'git');\n    }\n    const durationMs = Math.round(Date.now() - cloneStart);\n    logger.debug({ durationMs }, 'git clone completed');\n  }\n  config.currentBranchSha = (await git.raw(['rev-parse', 'HEAD'])).trim();\n  if (config.cloneSubmodules) {\n    const submodules = await getSubmodules();\n    for (const submodule of submodules) {\n      try {\n        logger.debug(`Cloning git submodule at ${submodule}`);\n        await git.submoduleUpdate(['--init', submodule]);\n      } catch (err) {\n        logger.warn(\n          { err },\n          `Unable to initialise git submodule at ${submodule}`\n        );\n      }\n    }\n  }\n  try {\n    const latestCommit = (await git.log({ n: 1 })).latest;\n    logger.debug({ latestCommit }, 'latest repository commit');\n  } catch (err) /* istanbul ignore next */ {\n    checkForPlatformFailure(err);\n    if (err.message.includes('does not have any commits yet')) {\n      throw new Error(REPOSITORY_EMPTY);\n    }\n    logger.warn({ err }, 'Cannot retrieve latest commit');\n  }\n  config.currentBranch = config.currentBranch || (await getDefaultBranch(git));\n}\n\n// istanbul ignore next\nexport async function getRepoStatus(): Promise<StatusResult> {\n  await syncGit();\n  return git.status();\n}\n\nexport function branchExists(branchName: string): boolean {\n  return !!config.branchCommits[branchName];\n}\n\n// Return the commit SHA for a branch\nexport function getBranchCommit(branchName: string): CommitSha | null {\n  return config.branchCommits[branchName] || null;\n}\n\n// Return the parent commit SHA for a branch\nexport async function getBranchParentSha(\n  branchName: string\n): Promise<CommitSha | null> {\n  try {\n    const branchSha = getBranchCommit(branchName);\n    const parentSha = await git.revparse([`${branchSha}^`]);\n    return parentSha;\n  } catch (err) {\n    logger.debug({ err }, 'Error getting branch parent sha');\n    return null;\n  }\n}\n\nexport async function getCommitMessages(): Promise<string[]> {\n  await syncGit();\n  logger.debug('getCommitMessages');\n  const res = await git.log({\n    n: 10,\n    format: { message: '%s' },\n  });\n  return res.all.map((commit) => commit.message);\n}\n\nexport async function checkoutBranch(branchName: string): Promise<CommitSha> {\n  logger.debug(`Setting current branch to ${branchName}`);\n  await syncGit();\n  try {\n    config.currentBranch = branchName;\n    config.currentBranchSha = (\n      await git.raw(['rev-parse', 'origin/' + branchName])\n    ).trim();\n    await git.checkout(['-f', branchName, '--']);\n    const latestCommitDate = (await git.log({ n: 1 }))?.latest?.date;\n    if (latestCommitDate) {\n      logger.debug({ branchName, latestCommitDate }, 'latest commit');\n    }\n    await git.reset(ResetMode.HARD);\n    return config.currentBranchSha;\n  } catch (err) /* istanbul ignore next */ {\n    checkForPlatformFailure(err);\n    if (err.message?.includes('fatal: ambiguous argument')) {\n      logger.warn({ err }, 'Failed to checkout branch');\n      throw new Error(TEMPORARY_ERROR);\n    }\n    throw err;\n  }\n}\n\nexport async function getFileList(): Promise<string[]> {\n  await syncGit();\n  const branch = config.currentBranch;\n  const submodules = await getSubmodules();\n  let files: string;\n  try {\n    files = await git.raw(['ls-tree', '-r', branch]);\n  } catch (err) /* istanbul ignore next */ {\n    if (err.message?.includes('fatal: Not a valid object name')) {\n      logger.debug(\n        { err },\n        'Branch not found when checking branch list - aborting'\n      );\n      throw new Error(REPOSITORY_CHANGED);\n    }\n    throw err;\n  }\n  // istanbul ignore if\n  if (!files) {\n    return [];\n  }\n  return files\n    .split('\\n')\n    .filter(Boolean)\n    .filter((line) => line.startsWith('100'))\n    .map((line) => line.split(regEx(/\\t/)).pop()) // TODO #12071\n    .filter((file: string) =>\n      submodules.every((submodule: string) => !file.startsWith(submodule))\n    );\n}\n\nexport function getBranchList(): string[] {\n  return Object.keys(config.branchCommits);\n}\n\nexport async function isBranchStale(branchName: string): Promise<boolean> {\n  await syncGit();\n  try {\n    const { currentBranchSha, currentBranch } = config;\n    const branches = await git.branch([\n      '--remotes',\n      '--verbose',\n      '--contains',\n      config.currentBranchSha,\n    ]);\n    const isStale = !branches.all.map(localName).includes(branchName);\n    logger.debug(\n      { isStale, currentBranch, currentBranchSha },\n      `isBranchStale=${isStale}`\n    );\n    return isStale;\n  } catch (err) /* istanbul ignore next */ {\n    checkForPlatformFailure(err);\n    throw err;\n  }\n}\n\nexport async function isBranchModified(branchName: string): Promise<boolean> {\n  await syncGit();\n  // First check cache\n  if (config.branchIsModified[branchName] !== undefined) {\n    return config.branchIsModified[branchName];\n  }\n  if (!branchExists(branchName)) {\n    logger.debug(\n      { branchName },\n      'Branch does not exist - cannot check isModified'\n    );\n    return false;\n  }\n  // Retrieve the author of the most recent commit\n  let lastAuthor: string;\n  try {\n    lastAuthor = (\n      await git.raw([\n        'log',\n        '-1',\n        '--pretty=format:%ae',\n        `origin/${branchName}`,\n        '--',\n      ])\n    ).trim();\n  } catch (err) /* istanbul ignore next */ {\n    if (err.message?.includes('fatal: bad revision')) {\n      logger.debug(\n        { err },\n        'Remote branch not found when checking last commit author - aborting run'\n      );\n      throw new Error(REPOSITORY_CHANGED);\n    }\n    logger.warn({ err }, 'Error checking last author for isBranchModified');\n  }\n  const { gitAuthorEmail } = config;\n  if (\n    lastAuthor === gitAuthorEmail ||\n    config.ignoredAuthors.some((ignoredAuthor) => lastAuthor === ignoredAuthor)\n  ) {\n    // author matches - branch has not been modified\n    config.branchIsModified[branchName] = false;\n    return false;\n  }\n  logger.debug(\n    { branchName, lastAuthor, gitAuthorEmail },\n    'Last commit author does not match git author email - branch has been modified'\n  );\n  config.branchIsModified[branchName] = true;\n  return true;\n}\n\nexport async function deleteBranch(branchName: string): Promise<void> {\n  await syncGit();\n  try {\n    await git.raw(['push', '--delete', 'origin', branchName]);\n    logger.debug({ branchName }, 'Deleted remote branch');\n  } catch (err) /* istanbul ignore next */ {\n    checkForPlatformFailure(err);\n    logger.debug({ branchName }, 'No remote branch to delete');\n  }\n  try {\n    await deleteLocalBranch(branchName);\n    // istanbul ignore next\n    logger.debug({ branchName }, 'Deleted local branch');\n  } catch (err) {\n    checkForPlatformFailure(err);\n    logger.debug({ branchName }, 'No local branch to delete');\n  }\n  delete config.branchCommits[branchName];\n}\n\nexport async function mergeBranch(branchName: string): Promise<void> {\n  let status;\n  try {\n    await syncGit();\n    await git.reset(ResetMode.HARD);\n    await git.checkout(['-B', branchName, 'origin/' + branchName]);\n    await git.checkout([\n      '-B',\n      config.currentBranch,\n      'origin/' + config.currentBranch,\n    ]);\n    status = await git.status();\n    await git.merge(['--ff-only', branchName]);\n    await git.push('origin', config.currentBranch);\n    incLimitedValue(Limit.Commits);\n  } catch (err) {\n    logger.debug(\n      {\n        baseBranch: config.currentBranch,\n        baseSha: config.currentBranchSha,\n        branchName,\n        branchSha: getBranchCommit(branchName),\n        status,\n        err,\n      },\n      'mergeBranch error'\n    );\n    throw err;\n  }\n}\n\nexport async function getBranchLastCommitTime(\n  branchName: string\n): Promise<Date> {\n  await syncGit();\n  try {\n    const time = await git.show(['-s', '--format=%ai', 'origin/' + branchName]);\n    return new Date(Date.parse(time));\n  } catch (err) {\n    checkForPlatformFailure(err);\n    return new Date();\n  }\n}\n\nexport async function getBranchFiles(branchName: string): Promise<string[]> {\n  await syncGit();\n  try {\n    const diff = await git.diffSummary([\n      `origin/${branchName}`,\n      `origin/${branchName}^`,\n    ]);\n    return diff.files.map((file) => file.file);\n  } catch (err) /* istanbul ignore next */ {\n    logger.warn({ err }, 'getBranchFiles error');\n    checkForPlatformFailure(err);\n    return null;\n  }\n}\n\nexport async function getFile(\n  filePath: string,\n  branchName?: string\n): Promise<string | null> {\n  await syncGit();\n  try {\n    const content = await git.show([\n      'origin/' + (branchName || config.currentBranch) + ':' + filePath,\n    ]);\n    return content;\n  } catch (err) {\n    checkForPlatformFailure(err);\n    return null;\n  }\n}\n\nexport async function hasDiff(branchName: string): Promise<boolean> {\n  await syncGit();\n  try {\n    return (await git.diff(['HEAD', branchName])) !== '';\n  } catch (err) {\n    return true;\n  }\n}\n\nexport async function commitFiles({\n  branchName,\n  files,\n  message,\n  force = false,\n}: CommitFilesConfig): Promise<CommitSha | null> {\n  await syncGit();\n  logger.debug(`Committing files to branch ${branchName}`);\n  if (!privateKeySet) {\n    await writePrivateKey();\n    privateKeySet = true;\n  }\n  const { localDir } = GlobalConfig.get();\n  await configSigningKey(localDir);\n  await writeGitAuthor();\n  try {\n    await git.reset(ResetMode.HARD);\n    await git.raw(['clean', '-fd']);\n    await git.checkout(['-B', branchName, 'origin/' + config.currentBranch]);\n    const deletedFiles: string[] = [];\n    const addedModifiedFiles: string[] = [];\n    const ignoredFiles: string[] = [];\n    for (const file of files) {\n      let fileName = file.name;\n      // istanbul ignore if\n      if (fileName === '|delete|') {\n        fileName = file.contents as string;\n        try {\n          await git.rm([fileName]);\n          deletedFiles.push(fileName);\n        } catch (err) /* istanbul ignore next */ {\n          checkForPlatformFailure(err);\n          logger.trace({ err, fileName }, 'Cannot delete file');\n          ignoredFiles.push(fileName);\n        }\n      } else {\n        if (await isDirectory(join(localDir, fileName))) {\n          // This is usually a git submodule update\n          logger.trace({ fileName }, 'Adding directory commit');\n        } else {\n          let contents: Buffer;\n          // istanbul ignore else\n          if (typeof file.contents === 'string') {\n            contents = Buffer.from(file.contents);\n          } else {\n            contents = file.contents;\n          }\n          // some file systems including Windows don't support the mode\n          // so the index should be manually updated after adding the file\n          await fs.outputFile(join(localDir, fileName), contents, {\n            mode: file.executable ? 0o777 : 0o666,\n          });\n        }\n        try {\n          // istanbul ignore next\n          const addParams =\n            fileName === configFileNames[0] ? ['-f', fileName] : fileName;\n          await git.add(addParams);\n          if (file.executable) {\n            await git.raw(['update-index', '--chmod=+x', fileName]);\n          }\n          addedModifiedFiles.push(fileName);\n        } catch (err) /* istanbul ignore next */ {\n          if (\n            !err.message.includes(\n              'The following paths are ignored by one of your .gitignore files'\n            )\n          ) {\n            throw err;\n          }\n          logger.debug({ fileName }, 'Cannot commit ignored file');\n          ignoredFiles.push(file.name);\n        }\n      }\n    }\n\n    const commitOptions: Options = {};\n    if (getNoVerify().includes('commit')) {\n      commitOptions['--no-verify'] = null;\n    }\n\n    const commitRes = await git.commit(message, [], commitOptions);\n    if (\n      commitRes.summary &&\n      commitRes.summary.changes === 0 &&\n      commitRes.summary.insertions === 0 &&\n      commitRes.summary.deletions === 0\n    ) {\n      logger.warn({ commitRes }, 'Detected empty commit - aborting git push');\n      return null;\n    }\n    logger.debug(\n      { deletedFiles, ignoredFiles, result: commitRes },\n      `git commit`\n    );\n    const commit = commitRes?.commit || 'unknown';\n    if (!force && !(await hasDiff(`origin/${branchName}`))) {\n      logger.debug(\n        { branchName, deletedFiles, addedModifiedFiles, ignoredFiles },\n        'No file changes detected. Skipping commit'\n      );\n      return null;\n    }\n\n    const pushOptions: TaskOptions = {\n      '--force-with-lease': null,\n      '-u': null,\n    };\n    if (getNoVerify().includes('push')) {\n      pushOptions['--no-verify'] = null;\n    }\n\n    const pushRes = await git.push(\n      'origin',\n      `${branchName}:${branchName}`,\n      pushOptions\n    );\n    delete pushRes.repo;\n    logger.debug({ result: pushRes }, 'git push');\n    // Fetch it after create\n    const ref = `refs/heads/${branchName}:refs/remotes/origin/${branchName}`;\n    await git.fetch(['origin', ref, '--force']);\n    config.branchCommits[branchName] = (\n      await git.revparse([branchName])\n    ).trim();\n    config.branchIsModified[branchName] = false;\n    incLimitedValue(Limit.Commits);\n    return commit;\n  } catch (err) /* istanbul ignore next */ {\n    checkForPlatformFailure(err);\n    if (err.message.includes(`'refs/heads/renovate' exists`)) {\n      const error = new Error(CONFIG_VALIDATION);\n      error.validationSource = 'None';\n      error.validationError = 'An existing branch is blocking Renovate';\n      error.validationMessage = `Renovate needs to create the branch \"${branchName}\" but is blocked from doing so because of an existing branch called \"renovate\". Please remove it so that Renovate can proceed.`;\n      throw error;\n    }\n    if (\n      err.message.includes(\n        'refusing to allow a GitHub App to create or update workflow'\n      )\n    ) {\n      logger.warn(\n        'App has not been granted permissions to update Workflows - aborting branch.'\n      );\n      return null;\n    }\n    if (\n      (err.message.includes('remote rejected') ||\n        err.message.includes('403')) &&\n      files?.some((file) => file.name?.startsWith('.github/workflows/'))\n    ) {\n      logger.debug({ err }, 'commitFiles error');\n      logger.info('Workflows update rejection - aborting branch.');\n      return null;\n    }\n    if (err.message.includes('protected branch hook declined')) {\n      const error = new Error(CONFIG_VALIDATION);\n      error.validationSource = branchName;\n      error.validationError = 'Renovate branch is protected';\n      error.validationMessage = `Renovate cannot push to its branch because branch protection has been enabled.`;\n      throw error;\n    }\n    if (err.message.includes('can only push your own commits')) {\n      const error = new Error(CONFIG_VALIDATION);\n      error.validationSource = branchName;\n      error.validationError = 'Bitbucket committer error';\n      error.validationMessage = `Renovate has experienced the following error when attempting to push its branch to the server: \"${String(\n        err.message\n      )}\"`;\n      throw error;\n    }\n    if (err.message.includes('remote: error: cannot lock ref')) {\n      logger.error({ err }, 'Error committing files.');\n      return null;\n    }\n    if (err.message.includes('[rejected] (stale info)')) {\n      logger.info(\n        'Branch update was rejected because local copy is not up-to-date.'\n      );\n      return null;\n    }\n    if (\n      err.message.includes('denying non-fast-forward') ||\n      err.message.includes('GH003: Sorry, force-pushing')\n    ) {\n      logger.debug({ err }, 'Permission denied to update branch');\n      const error = new Error(CONFIG_VALIDATION);\n      error.validationSource = branchName;\n      error.validationError = 'Force push denied';\n      error.validationMessage = `Renovate is unable to update branch(es) due to force pushes being disallowed.`;\n      throw error;\n    }\n    logger.debug({ err }, 'Unknown error committing files');\n    // We don't know why this happened, so this will cause bubble up to a branch error\n    throw err;\n  }\n}\n\nexport function getUrl({\n  protocol,\n  auth,\n  hostname,\n  host,\n  repository,\n}: {\n  protocol?: GitProtocol;\n  auth?: string;\n  hostname?: string;\n  host?: string;\n  repository: string;\n}): string {\n  if (protocol === 'ssh') {\n    return `git@${hostname}:${repository}.git`;\n  }\n  return URL.format({\n    protocol: protocol || 'https',\n    auth,\n    hostname,\n    host,\n    pathname: repository + '.git',\n  });\n}\n"]}