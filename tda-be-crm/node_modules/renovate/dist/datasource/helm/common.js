"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.findSourceUrl = void 0;
const regex_1 = require("../../util/regex");
const chartRepo = (0, regex_1.regEx)(/charts?|helm|helm-charts/i);
const githubUrl = (0, regex_1.regEx)(/^(?<url>https:\/\/github\.com\/[^/]+\/(?<repo>[^/]+))(?:\/|$)/);
const githubRelease = (0, regex_1.regEx)(/^(https:\/\/github\.com\/[^/]+\/[^/]+)\/releases\//);
function findSourceUrl(release) {
    var _a;
    // it's a github release :)
    let match = githubRelease.exec(release.urls[0]);
    if (match) {
        return match[1];
    }
    match = githubUrl.exec(release.home);
    if (chartRepo.test(match === null || match === void 0 ? void 0 : match.groups.repo)) {
        return match.groups.url;
    }
    if (!((_a = release.sources) === null || _a === void 0 ? void 0 : _a.length)) {
        return undefined;
    }
    for (const url of release.sources) {
        match = githubUrl.exec(url);
        if (chartRepo.test(match === null || match === void 0 ? void 0 : match.groups.repo)) {
            return match.groups.url;
        }
    }
    // fallback
    return release.sources[0];
}
exports.findSourceUrl = findSourceUrl;
//# sourceMappingURL=common.js.map