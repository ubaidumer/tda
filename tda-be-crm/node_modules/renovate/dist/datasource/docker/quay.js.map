{"version":3,"file":"quay.js","sourceRoot":"","sources":["../../../lib/datasource/docker/quay.ts"],"names":[],"mappings":";;;AAAA,qCAAgC;AAEzB,KAAK,UAAU,mBAAmB,CACvC,QAAgB,EAChB,UAAkB;IAElB,IAAI,IAAI,GAAa,EAAE,CAAC;IACxB,MAAM,KAAK,GAAG,GAAG,CAAC;IAElB,MAAM,OAAO,GAAG,CAAC,IAAY,EAAU,EAAE,CACvC,GAAG,QAAQ,sBAAsB,UAAU,eAAe,KAAK,SAAS,IAAI,sBAAsB,CAAC;IAErG,IAAI,IAAI,GAAG,CAAC,CAAC;IACb,IAAI,GAAG,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC;IACxB,GAAG;QACD,MAAM,GAAG,GAAG,MAAM,aAAI,CAAC,OAAO,CAG3B,GAAG,EAAE,EAAE,CAAC,CAAC;QACZ,MAAM,QAAQ,GAAG,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,GAAG,EAAE,EAAE,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;QACtD,IAAI,GAAG,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;QAC7B,IAAI,IAAI,CAAC,CAAC;QACV,GAAG,GAAG,GAAG,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC;KACtD,QAAQ,GAAG,IAAI,IAAI,GAAG,EAAE,EAAE;IAC3B,OAAO,IAAI,CAAC;AACd,CAAC;AAvBD,kDAuBC","sourcesContent":["import { http } from './common';\n\nexport async function getTagsQuayRegistry(\n  registry: string,\n  repository: string\n): Promise<string[]> {\n  let tags: string[] = [];\n  const limit = 100;\n\n  const pageUrl = (page: number): string =>\n    `${registry}/api/v1/repository/${repository}/tag/?limit=${limit}&page=${page}&onlyActiveTags=true`;\n\n  let page = 1;\n  let url = pageUrl(page);\n  do {\n    const res = await http.getJson<{\n      tags: { name: string }[];\n      has_additional: boolean;\n    }>(url, {});\n    const pageTags = res.body.tags.map((tag) => tag.name);\n    tags = tags.concat(pageTags);\n    page += 1;\n    url = res.body.has_additional ? pageUrl(page) : null;\n  } while (url && page < 20);\n  return tags;\n}\n"]}