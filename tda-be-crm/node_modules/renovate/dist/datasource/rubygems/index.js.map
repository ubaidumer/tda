{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../lib/datasource/rubygems/index.ts"],"names":[],"mappings":";;;;AAAA,kEAA2D;AAC3D,wCAA0C;AAC1C,mFAAwD;AACxD,8CAA2C;AAE3C,+BAAmD;AACnD,yDAA2D;AAE3D,MAAa,kBAAmB,SAAQ,uBAAU;IAGhD;QACE,KAAK,CAAC,kBAAkB,CAAC,EAAE,CAAC,CAAC;QASb,wBAAmB,GAAG,CAAC,sBAAsB,CAAC,CAAC;QAE/C,sBAAiB,GAAG,cAAc,CAAC,EAAE,CAAC;QAEtC,qBAAgB,GAAG,MAAM,CAAC;QAZ1C,IAAI,CAAC,qBAAqB,GAAG,IAAI,wCAAqB,CACpD,kBAAkB,CAAC,EAAE,CACtB,CAAC;QACF,IAAI,CAAC,0BAA0B,GAAG,IAAI,gCAA0B,CAC9D,kBAAkB,CAAC,EAAE,CACtB,CAAC;IACJ,CAAC;IAiBD,WAAW,CAAC,EACV,UAAU,EACV,WAAW,GACO;;QAClB,IAAI,CAAA,MAAA,IAAA,cAAQ,EAAC,WAAW,CAAC,0CAAE,QAAQ,MAAK,cAAc,EAAE;YACtD,OAAO,IAAI,CAAC,qBAAqB,CAAC,WAAW,CAAC,EAAE,UAAU,EAAE,CAAC,CAAC;SAC/D;QACD,OAAO,IAAI,CAAC,0BAA0B,CAAC,WAAW,CAAC;YACjD,UAAU;YACV,WAAW;SACZ,CAAC,CAAC;IACL,CAAC;;AAtCe,qBAAE,GAAG,UAAU,CAAC;AA2BhC;IALC,IAAA,iBAAK,EAAC;QACL,SAAS,EAAE,cAAc,kBAAkB,CAAC,EAAE,EAAE;QAChD,GAAG,EAAE,CAAC,EAAE,WAAW,EAAE,UAAU,EAAqB,EAAE,EAAE,CACtD,GAAG,WAAW,IAAI,UAAU,EAAE;KACjC,CAAC;qDAYD;AAvCH,gDAwCC","sourcesContent":["import { cache } from '../../util/cache/package/decorator';\nimport { parseUrl } from '../../util/url';\nimport * as rubyVersioning from '../../versioning/ruby';\nimport { Datasource } from '../datasource';\nimport { GetReleasesConfig, ReleaseResult } from '../types';\nimport { InternalRubyGemsDatasource } from './get';\nimport { RubyGemsOrgDatasource } from './get-rubygems-org';\n\nexport class RubyGemsDatasource extends Datasource {\n  static readonly id = 'rubygems';\n\n  constructor() {\n    super(RubyGemsDatasource.id);\n    this.rubyGemsOrgDatasource = new RubyGemsOrgDatasource(\n      RubyGemsDatasource.id\n    );\n    this.internalRubyGemsDatasource = new InternalRubyGemsDatasource(\n      RubyGemsDatasource.id\n    );\n  }\n\n  override readonly defaultRegistryUrls = ['https://rubygems.org'];\n\n  override readonly defaultVersioning = rubyVersioning.id;\n\n  override readonly registryStrategy = 'hunt';\n\n  private readonly rubyGemsOrgDatasource: RubyGemsOrgDatasource;\n\n  private readonly internalRubyGemsDatasource: InternalRubyGemsDatasource;\n\n  @cache({\n    namespace: `datasource-${RubyGemsDatasource.id}`,\n    key: ({ registryUrl, lookupName }: GetReleasesConfig) =>\n      `${registryUrl}/${lookupName}`,\n  })\n  getReleases({\n    lookupName,\n    registryUrl,\n  }: GetReleasesConfig): Promise<ReleaseResult | null> {\n    if (parseUrl(registryUrl)?.hostname === 'rubygems.org') {\n      return this.rubyGemsOrgDatasource.getReleases({ lookupName });\n    }\n    return this.internalRubyGemsDatasource.getReleases({\n      lookupName,\n      registryUrl,\n    });\n  }\n}\n"]}