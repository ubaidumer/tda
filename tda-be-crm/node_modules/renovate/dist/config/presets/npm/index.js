"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getPreset = void 0;
const npmrc_1 = require("../../../datasource/npm/npmrc");
const logger_1 = require("../../../logger");
const http_1 = require("../../../util/http");
const util_1 = require("../util");
const id = 'npm';
const http = new http_1.Http(id);
async function getPreset({ packageName, presetName = 'default', }) {
    let dep;
    try {
        const { headers, packageUrl } = (0, npmrc_1.resolvePackage)(packageName);
        const body = (await http.getJson(packageUrl, { headers }))
            .body;
        dep = body.versions[body['dist-tags'].latest];
    }
    catch (err) {
        throw new Error(util_1.PRESET_DEP_NOT_FOUND);
    }
    if (!dep['renovate-config']) {
        throw new Error(util_1.PRESET_RENOVATE_CONFIG_NOT_FOUND);
    }
    const presetConfig = dep['renovate-config'][presetName];
    if (!presetConfig) {
        const presetNames = Object.keys(dep['renovate-config']);
        logger_1.logger.debug({ presetNames, presetName }, 'Preset not found within renovate-config');
        throw new Error(util_1.PRESET_NOT_FOUND);
    }
    return presetConfig;
}
exports.getPreset = getPreset;
//# sourceMappingURL=index.js.map