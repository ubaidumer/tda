{"version":3,"file":"extract.js","sourceRoot":"","sources":["../../../lib/manager/cloudbuild/extract.ts"],"names":[],"mappings":";;;;AAAA,uEAAkC;AAClC,qCAA+B;AAC/B,yCAAsC;AACtC,mDAA+C;AAG/C,SAAgB,kBAAkB,CAAC,OAAe;;IAChD,MAAM,IAAI,GAAwB,EAAE,CAAC;IACrC,IAAI;QACF,kBAAkB;QAClB,MAAM,GAAG,GAAQ,IAAA,cAAI,EAAC,OAAO,CAAC,CAAC;QAC/B,IAAI,CAAA,GAAG,aAAH,GAAG,uBAAH,GAAG,CAAE,KAAK,KAAI,YAAE,CAAC,KAAK,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE;YACrC,KAAK,MAAM,IAAI,IAAI,GAAG,CAAC,KAAK,EAAE;gBAC5B,IAAI,IAAI,CAAC,IAAI,EAAE;oBACb,MAAM,GAAG,GAAG,IAAA,gBAAM,EAAC,IAAI,CAAC,IAAI,CAAC,CAAC;oBAC9B,eAAM,CAAC,KAAK,CACV;wBACE,OAAO,EAAE,GAAG,CAAC,OAAO;wBACpB,YAAY,EAAE,GAAG,CAAC,YAAY;wBAC9B,aAAa,EAAE,GAAG,CAAC,aAAa;qBACjC,EACD,0BAA0B,CAC3B,CAAC;oBAEF,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;iBAChB;aACF;SACF;KACF;IAAC,OAAO,GAAG,EAAE,0BAA0B,CAAC;QACvC,IAAI,MAAA,GAAG,CAAC,KAAK,0CAAE,UAAU,CAAC,gBAAgB,CAAC,EAAE;YAC3C,eAAM,CAAC,KAAK,CACV,EAAE,GAAG,EAAE,EACP,gFAAgF,CACjF,CAAC;SACH;aAAM;YACL,eAAM,CAAC,IAAI,CACT,EAAE,GAAG,EAAE,EACP,uEAAuE,CACxE,CAAC;SACH;KACF;IACD,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE;QAChB,OAAO,IAAI,CAAC;KACb;IACD,OAAO,EAAE,IAAI,EAAE,CAAC;AAClB,CAAC;AAvCD,gDAuCC","sourcesContent":["import is from '@sindresorhus/is';\nimport { load } from 'js-yaml';\nimport { logger } from '../../logger';\nimport { getDep } from '../dockerfile/extract';\nimport type { PackageDependency, PackageFile } from '../types';\n\nexport function extractPackageFile(content: string): PackageFile {\n  const deps: PackageDependency[] = [];\n  try {\n    // TODO: fix types\n    const doc: any = load(content);\n    if (doc?.steps && is.array(doc.steps)) {\n      for (const step of doc.steps) {\n        if (step.name) {\n          const dep = getDep(step.name);\n          logger.trace(\n            {\n              depName: dep.depName,\n              currentValue: dep.currentValue,\n              currentDigest: dep.currentDigest,\n            },\n            'Cloud Build docker image'\n          );\n\n          deps.push(dep);\n        }\n      }\n    }\n  } catch (err) /* istanbul ignore next */ {\n    if (err.stack?.startsWith('YAMLException:')) {\n      logger.debug(\n        { err },\n        'YAML exception extracting Docker images from a Cloud Build configuration file.'\n      );\n    } else {\n      logger.warn(\n        { err },\n        'Error extracting Docker images from a Cloud Build configuration file.'\n      );\n    }\n  }\n  if (!deps.length) {\n    return null;\n  }\n  return { deps };\n}\n"]}