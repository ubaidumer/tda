{"version":3,"file":"util.js","sourceRoot":"","sources":["../../../lib/manager/terraform/util.ts"],"names":[],"mappings":";;;AAAA,4EAAkF;AAClF,4CAAyC;AAEzC,qCAAoD;AAGvC,QAAA,uBAAuB,GAAG,IAAA,aAAK,EAC1C,gDAAgD,CACjD,CAAC;AACW,QAAA,2BAA2B,GAAG,IAAA,aAAK,EAC9C,yDAAyD,CAC1D,CAAC;AAEF,SAAgB,0BAA0B,CACxC,KAAa;IAEb,QAAQ,KAAK,EAAE;QACb,KAAK,QAAQ,CAAC,CAAC;YACb,OAAO,iCAAwB,CAAC,MAAM,CAAC;SACxC;QACD,KAAK,UAAU,CAAC,CAAC;YACf,OAAO,iCAAwB,CAAC,QAAQ,CAAC;SAC1C;QACD,KAAK,oBAAoB,CAAC,CAAC;YACzB,OAAO,iCAAwB,CAAC,kBAAkB,CAAC;SACpD;QACD,KAAK,UAAU,CAAC,CAAC;YACf,OAAO,iCAAwB,CAAC,QAAQ,CAAC;SAC1C;QACD,KAAK,WAAW,CAAC,CAAC;YAChB,OAAO,iCAAwB,CAAC,iBAAiB,CAAC;SACnD;QACD,OAAO,CAAC,CAAC;YACP,OAAO,iCAAwB,CAAC,OAAO,CAAC;SACzC;KACF;AACH,CAAC;AAvBD,gEAuBC;AAED,SAAgB,2BAA2B,CACzC,OAAe,EACf,SAAmB;IAEnB,OAAO,SAAS,CAAC,IAAI,CAAC,CAAC,KAAK,EAAE,EAAE,CAAC,OAAO,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC;AAC5D,CAAC;AALD,kEAKC;AAED,MAAM,eAAe,GAAG,IAAA,aAAK,EAAC,kBAAkB,CAAC,CAAC;AAClD,SAAgB,mBAAmB,CAAC,IAAY;IAC9C,MAAM,KAAK,GAAG,eAAe,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IACzC,OAAO,CAAC,CAAC,KAAK,CAAC;AACjB,CAAC;AAHD,kDAGC;AAED,SAAgB,yBAAyB,CAAC,GAAsB;IAC9D,IAAI,CAAC,GAAG,CAAC,UAAU,EAAE;QACnB,GAAG,CAAC,UAAU,GAAG,GAAG,CAAC,OAAO,CAAC;KAC9B;IACD,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAE;QACjC,GAAG,CAAC,UAAU,GAAG,aAAa,GAAG,CAAC,UAAU,EAAE,CAAC;KAChD;IAED,sCAAsC;IACtC,GAAG,CAAC,UAAU,GAAG,GAAG,CAAC,UAAU,CAAC,WAAW,EAAE,CAAC;AAChD,CAAC;AAVD,8DAUC;AAED,SAAgB,gBAAgB,CAC9B,GAAsB,EACtB,KAAqB;IAErB,MAAM,cAAc,GAAG,GAAG,CAAC,YAAY;QACrC,CAAC,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC,CAAC;QACrB,CAAC,CAAC,gDAA2B,CAAC,mBAAmB,CAAC,CAAC,CAAC,CAAC;IACvD,MAAM,SAAS,GAAG,KAAK,CAAC,IAAI,CAC1B,CAAC,IAAI,EAAE,EAAE,CACP,IAAI,CAAC,UAAU,KAAK,GAAG,CAAC,UAAU,IAAI,IAAI,CAAC,WAAW,KAAK,cAAc,CAC5E,CAAC;IACF,IAAI,SAAS,EAAE;QACb,OAAO,SAAS,CAAC,OAAO,CAAC;KAC1B;IACD,OAAO,SAAS,CAAC;AACnB,CAAC;AAfD,4CAeC","sourcesContent":["import { TerraformProviderDatasource } from '../../datasource/terraform-provider';\nimport { regEx } from '../../util/regex';\nimport type { PackageDependency } from '../types';\nimport { TerraformDependencyTypes } from './common';\nimport type { ProviderLock } from './lockfile/types';\n\nexport const keyValueExtractionRegex = regEx(\n  /^\\s*(?<key>[^\\s]+)\\s+=\\s+\"(?<value>[^\"]+)\"\\s*$/\n);\nexport const resourceTypeExtractionRegex = regEx(\n  /^\\s*resource\\s+\"(?<type>[^\\s]+)\"\\s+\"(?<name>[^\"]+)\"\\s*{/\n);\n\nexport function getTerraformDependencyType(\n  value: string\n): TerraformDependencyTypes {\n  switch (value) {\n    case 'module': {\n      return TerraformDependencyTypes.module;\n    }\n    case 'provider': {\n      return TerraformDependencyTypes.provider;\n    }\n    case 'required_providers': {\n      return TerraformDependencyTypes.required_providers;\n    }\n    case 'resource': {\n      return TerraformDependencyTypes.resource;\n    }\n    case 'terraform': {\n      return TerraformDependencyTypes.terraform_version;\n    }\n    default: {\n      return TerraformDependencyTypes.unknown;\n    }\n  }\n}\n\nexport function checkFileContainsDependency(\n  content: string,\n  checkList: string[]\n): boolean {\n  return checkList.some((check) => content.includes(check));\n}\n\nconst pathStringRegex = regEx(/(.|..)?(\\/[^/])+/);\nexport function checkIfStringIsPath(path: string): boolean {\n  const match = pathStringRegex.exec(path);\n  return !!match;\n}\n\nexport function massageProviderLookupName(dep: PackageDependency): void {\n  if (!dep.lookupName) {\n    dep.lookupName = dep.depName;\n  }\n  if (!dep.lookupName.includes('/')) {\n    dep.lookupName = `hashicorp/${dep.lookupName}`;\n  }\n\n  // handle cases like `Telmate/proxmox`\n  dep.lookupName = dep.lookupName.toLowerCase();\n}\n\nexport function getLockedVersion(\n  dep: PackageDependency,\n  locks: ProviderLock[]\n): string {\n  const depRegistryUrl = dep.registryUrls\n    ? dep.registryUrls[0]\n    : TerraformProviderDatasource.defaultRegistryUrls[0];\n  const foundLock = locks.find(\n    (lock) =>\n      lock.lookupName === dep.lookupName && lock.registryUrl === depRegistryUrl\n  );\n  if (foundLock) {\n    return foundLock.version;\n  }\n  return undefined;\n}\n"]}