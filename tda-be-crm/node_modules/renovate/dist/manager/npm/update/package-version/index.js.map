{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../../../lib/manager/npm/update/package-version/index.ts"],"names":[],"mappings":";;;AAAA,mCAA0C;AAC1C,+CAA4C;AAC5C,kDAA+C;AAG/C,SAAgB,kBAAkB,CAChC,OAAe,EACf,YAAoB,EACpB,WAAiC;IAEjC,eAAM,CAAC,KAAK,CACV,EAAE,WAAW,EAAE,YAAY,EAAE,EAC7B,iDAAiD,CAClD,CAAC;IACF,IAAI,YAAoB,CAAC;IACzB,IAAI,aAAa,GAAG,OAAO,CAAC;IAC5B,IAAI;QACF,IAAI,WAAW,CAAC,UAAU,CAAC,SAAS,CAAC,EAAE;YACrC,MAAM,aAAa,GAAG,WAAW,CAAC,OAAO,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC;YACzD,MAAM,aAAa,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;YAC1C,YAAY;gBACV,CAAC,aAAa,CAAC,YAAY,IAAI,EAAE,CAAC,CAAC,aAAa,CAAC;oBACjD,CAAC,aAAa,CAAC,eAAe,IAAI,EAAE,CAAC,CAAC,aAAa,CAAC;oBACpD,CAAC,aAAa,CAAC,oBAAoB,IAAI,EAAE,CAAC,CAAC,aAAa,CAAC;oBACzD,CAAC,aAAa,CAAC,gBAAgB,IAAI,EAAE,CAAC,CAAC,aAAa,CAAC,CAAC;YACxD,IAAI,CAAC,YAAY,EAAE;gBACjB,eAAM,CAAC,IAAI,CAAC,wCAAwC,GAAG,aAAa,CAAC,CAAC;gBACtE,OAAO,EAAE,aAAa,EAAE,CAAC;aAC1B;SACF;aAAM;YACL,YAAY,GAAG,IAAA,YAAG,EAAC,YAAY,EAAE,WAA0B,CAAC,CAAC;SAC9D;QACD,eAAM,CAAC,KAAK,CAAC,EAAE,YAAY,EAAE,CAAC,CAAC;QAC/B,aAAa,GAAG,OAAO,CAAC,OAAO,CAC7B,IAAA,aAAK,EAAC,kCAAkC,CAAC,EACzC,aAAa,YAAY,EAAE,CAC5B,CAAC;QACF,IAAI,aAAa,KAAK,OAAO,EAAE;YAC7B,eAAM,CAAC,KAAK,CAAC,4BAA4B,CAAC,CAAC;SAC5C;aAAM;YACL,eAAM,CAAC,KAAK,CAAC,6BAA6B,CAAC,CAAC;SAC7C;KACF;IAAC,OAAO,GAAG,EAAE;QACZ,eAAM,CAAC,IAAI,CACT;YACE,OAAO;YACP,YAAY;YACZ,WAAW;SACZ,EACD,uBAAuB,CACxB,CAAC;KACH;IACD,OAAO,EAAE,aAAa,EAAE,CAAC;AAC3B,CAAC;AAhDD,gDAgDC","sourcesContent":["import { ReleaseType, inc } from 'semver';\nimport { logger } from '../../../../logger';\nimport { regEx } from '../../../../util/regex';\nimport type { BumpPackageVersionResult } from '../../../types';\n\nexport function bumpPackageVersion(\n  content: string,\n  currentValue: string,\n  bumpVersion: ReleaseType | string\n): BumpPackageVersionResult {\n  logger.debug(\n    { bumpVersion, currentValue },\n    'Checking if we should bump package.json version'\n  );\n  let newPjVersion: string;\n  let bumpedContent = content;\n  try {\n    if (bumpVersion.startsWith('mirror:')) {\n      const mirrorPackage = bumpVersion.replace('mirror:', '');\n      const parsedContent = JSON.parse(content);\n      newPjVersion =\n        (parsedContent.dependencies || {})[mirrorPackage] ||\n        (parsedContent.devDependencies || {})[mirrorPackage] ||\n        (parsedContent.optionalDependencies || {})[mirrorPackage] ||\n        (parsedContent.peerDependencies || {})[mirrorPackage];\n      if (!newPjVersion) {\n        logger.warn('bumpVersion mirror package not found: ' + mirrorPackage);\n        return { bumpedContent };\n      }\n    } else {\n      newPjVersion = inc(currentValue, bumpVersion as ReleaseType);\n    }\n    logger.debug({ newPjVersion });\n    bumpedContent = content.replace(\n      regEx(`(?<version>\"version\":\\\\s*\")[^\"]*`),\n      `$<version>${newPjVersion}`\n    );\n    if (bumpedContent === content) {\n      logger.debug('Version was already bumped');\n    } else {\n      logger.debug('Bumped package.json version');\n    }\n  } catch (err) {\n    logger.warn(\n      {\n        content,\n        currentValue,\n        bumpVersion,\n      },\n      'Failed to bumpVersion'\n    );\n  }\n  return { bumpedContent };\n}\n"]}