{"version":3,"file":"user.js","sourceRoot":"","sources":["../../../lib/platform/github/user.ts"],"names":[],"mappings":";;;;AAAA,yCAAsC;AACtC,gFAAqD;AAErD,MAAM,SAAS,GAAG,IAAI,UAAU,CAAC,UAAU,EAAE,CAAC;AAO9C,IAAI,WAAwB,CAAC;AAEtB,KAAK,UAAU,cAAc,CAClC,QAAgB,EAChB,KAAa;IAEb,IAAI,WAAW,EAAE;QACf,OAAO,WAAW,CAAC;KACpB;IACD,IAAI;QACF,MAAM,QAAQ,GAAG,CACf,MAAM,SAAS,CAAC,OAAO,CACrB,QAAQ,GAAG,MAAM,EACjB;YACE,KAAK;SACN,CACF,CACF,CAAC,IAAI,CAAC;QACP,WAAW,GAAG;YACZ,QAAQ,EAAE,QAAQ,CAAC,KAAK;YACxB,IAAI,EAAE,QAAQ,CAAC,IAAI;SACpB,CAAC;QACF,OAAO,WAAW,CAAC;KACpB;IAAC,OAAO,GAAG,EAAE;QACZ,eAAM,CAAC,KAAK,CAAC,EAAE,GAAG,EAAE,EAAE,kCAAkC,CAAC,CAAC;QAC1D,MAAM,IAAI,KAAK,CAAC,8BAA8B,CAAC,CAAC;KACjD;AACH,CAAC;AAzBD,wCAyBC;AAED,IAAI,SAAiB,CAAC;AAEf,KAAK,UAAU,YAAY,CAChC,QAAgB,EAChB,KAAa;IAEb,IAAI;QACF,MAAM,MAAM,GAAG,CACb,MAAM,SAAS,CAAC,OAAO,CAAsB,QAAQ,GAAG,aAAa,EAAE;YACrE,KAAK;SACN,CAAC,CACH,CAAC,IAAI,CAAC;QACP,SAAS,GAAG,CAAA,MAAM,aAAN,MAAM,uBAAN,MAAM,CAAG,CAAC,EAAE,KAAK,KAAI,IAAI,CAAC;QACtC,OAAO,SAAS,CAAC;KAClB;IAAC,OAAO,GAAG,EAAE;QACZ,eAAM,CAAC,KAAK,CACV,kEAAkE,CACnE,CAAC;QACF,OAAO,IAAI,CAAC;KACb;AACH,CAAC;AAlBD,oCAkBC","sourcesContent":["import { logger } from '../../logger';\nimport * as githubHttp from '../../util/http/github';\n\nconst githubApi = new githubHttp.GithubHttp();\n\nexport interface UserDetails {\n  username: string;\n  name: string;\n}\n\nlet userDetails: UserDetails;\n\nexport async function getUserDetails(\n  endpoint: string,\n  token: string\n): Promise<UserDetails> {\n  if (userDetails) {\n    return userDetails;\n  }\n  try {\n    const userData = (\n      await githubApi.getJson<{ login: string; name: string }>(\n        endpoint + 'user',\n        {\n          token,\n        }\n      )\n    ).body;\n    userDetails = {\n      username: userData.login,\n      name: userData.name,\n    };\n    return userDetails;\n  } catch (err) {\n    logger.debug({ err }, 'Error authenticating with GitHub');\n    throw new Error('Init: Authentication failure');\n  }\n}\n\nlet userEmail: string;\n\nexport async function getUserEmail(\n  endpoint: string,\n  token: string\n): Promise<string | null> {\n  try {\n    const emails = (\n      await githubApi.getJson<{ email: string }[]>(endpoint + 'user/emails', {\n        token,\n      })\n    ).body;\n    userEmail = emails?.[0].email || null;\n    return userEmail;\n  } catch (err) {\n    logger.debug(\n      'Cannot read user/emails endpoint on GitHub to retrieve gitAuthor'\n    );\n    return null;\n  }\n}\n"]}